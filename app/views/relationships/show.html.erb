<%- model_class = Relationship -%>

<div class="row">
  <div class="span12">
    <% person1_name = @relationship.get_person1_name %>
    <% person2_name = @relationship.get_person2_name %>
    <h1>Relationship: <%= person1_name + " & " + person2_name%></h1>
  </div>
</div>
<br>
<div class="row">
  <div class="span5">
    <div class="well">
      <h2>Information
        <% if can? :update, @relationship %> 
          <%= link_to t('.edit', :default => t("helpers.links.edit")),
                  edit_relationship_path(@relationship), :class => 'btn btn-mini' %>
        <% end %>
        <% if can? :delete, @relationship %>
          <%= link_to 'Destroy', @relationship, :class => 'btn btn-mini btn-danger',method: :delete, data: { confirm: 'Are you sure that you want to permanently delete this record and all associated records?' } %>
        <% end %>
      </h2>
      <br>
      <dl class="dl-horizontal">
        <dt><strong>SDFB Relationship ID:</strong></dt>
        <dd><%= @relationship.id %></dd>
        <dt><strong>Maximum Certainty:</strong></dt>
        <dd><%= @relationship.max_certainty %>%</dd>
        <dt><strong>Creator's Certainty:</strong></dt>
        <dd><%= @relationship.original_certainty %>%</dd>
        <dt><strong>Person 1:</strong></dt>
        <dd><%= link_to person1_name,  person_path(@relationship.person1_index) %></dd>
        <dt><strong>Person 2:</strong></dt>
        <dd><%= link_to person2_name,  person_path(@relationship.person2_index) %></dd>
        <dt><strong>Start Date Type:</strong></dt>
        <% if ! @relationship.start_date_type.blank? %>
          <dd>
            <% if @relationship.start_date_type == "BF" %>
              <dd>Before</dd>
            <% elsif @relationship.start_date_type == "AF" %>
              <dd>After</dd>
            <% elsif @relationship.start_date_type == "IN" %>
              <dd>In</dd>
            <% elsif @relationship.start_date_type == "CA" %>
              <dd>Circa</dd>
            <% elsif @relationship.start_date_type == "BF/IN" %>
              <dd>Before or In</dd>
            <% elsif @relationship.start_date_type == "AF/IN" %>
              <dd>After or In</dd>
            <% end %>
          </dd>
        <% else %>
          <dd>Unknown</dd>
        <% end %>
        <% if ((! @relationship.start_month.blank?) || (! @relationship.start_day.blank?) || (! @relationship.start_year.blank?)) %>
          <dt><strong>Start Date:</strong></dt>
          <dd><% if ! @relationship.start_month.blank? %>
            <%= @relationship.start_month %>
          <% end %>  
          <% if ! @relationship.start_day.blank? %>
            <%= @relationship.start_day %>,
          <% end %>
          <% if ! @relationship.start_year.blank? %>
            <%= @relationship.start_year %>
          <% end %></dd>
        <% else %>
          <dt><strong>Start Date:</strong></dt>
          <dd>Unknown</dd>
        <% end %>
        <dt><strong>End Date Type:</strong></dt>
        <% if ! @relationship.end_date_type.blank? %> 
          <dd>
            <% if @relationship.end_date_type == "BF" %>
              <dd>Before</dd>
            <% elsif @relationship.end_date_type == "AF" %>
              <dd>After</dd>
            <% elsif @relationship.end_date_type == "IN" %>
              <dd>In</dd>
            <% elsif @relationship.end_date_type == "CA" %>
              <dd>Circa</dd>
            <% elsif @relationship.end_date_type == "BF/IN" %>
              <dd>Before or In</dd>
            <% elsif @relationship.end_date_type == "AF/IN" %>
              <dd>After or In</dd>
            <% end %>
          </dd>
        <% else %>
          <dd>Unknown</dd>
        <% end %>
        <% if ((! @relationship.end_month.blank?) || (! @relationship.end_day.blank?) || (! @relationship.end_year.blank?)) %>
          <dt><strong>End Date:</strong></dt>
          <dd><% if ! @relationship.end_month.blank? %>
            <%= @relationship.end_month %>
          <% end %>  
          <% if ! @relationship.end_day.blank? %>
            <%= @relationship.end_day %>,
          <% end %>
          <% if ! @relationship.end_year.blank? %>
            <%= @relationship.end_year %>
          <% end %></dd>
        <% else %>
          <dt><strong>End Date:</strong></dt>
          <dd>Unknown</dd>
        <% end %>
        <% if (! current_user.blank?) && ((current_user.user_type == "Admin") || (current_user.user_type == "Curator")) %>
          <dt><strong>Created:</strong></dt>
          <dd><%= @relationship.created_at.strftime("%m/%d/%Y") %> by <%= link_to User.find(@relationship.created_by).username,  user_path(@relationship.created_by) %></dd>
          <% @last_edit = @relationship.last_edit %>
          <% if @last_edit[0] != 0 %>
          <% if ! @last_edit[0].nil? %>  
              <dt><strong>Last Edit:</strong></dt>
              <dd><%= @last_edit[1].strftime("%m/%d/%Y")%> by <%= link_to User.find(@last_edit[0]).username,  user_path(@last_edit[0]) %></dd>
            <% end %>
          <% end %>
          <dt><strong>Is Approved?:</strong></dt>
          <dd><%= @relationship.is_approved %></dd>
          <% if ! @relationship.approved_by.blank? %>
            <dt><strong>Approved By:</strong></dt>
            <dd><%= link_to User.find(@relationship.approved_by).username,  user_path(@relationship.approved_by) %></dd></dd>
          <% end %>
          <% if ! @relationship.approved_by.blank? %>
            <dt><strong>Approved On:</strong></dt>
            <% if ! @relationship.approved_on.nil? %>
              <dd><%= @relationship.approved_on %></dd>
            <% else %>
              <dd>Unknown</dd>
            <% end %>
          <% end %>
          <% if ! @relationship.justification.blank? %>
            <dt><strong>Justification:</strong></dt>
            <dd><%= @relationship.justification %></dd>
          <% end %>
          <dt>Is Active:</dt>
          <dd><%= @relationship.is_active %></dd>
          <dt>Is Rejected:</dt>
          <dd><%= @relationship.is_rejected %></dd>
        <% end %>
      </dl>
    </div>
  </div>

  <div class="span7">
    <% if ! @user_rel_contribs.empty? %>
      <div class="well">
      <h2>Relationship Types for <%= @relationship.get_person1_name + " & " + @relationship.get_person2_name%> <%= link_to 'Assign New Relationship Type',
                  new_user_rel_contrib_path(:relationship_id => @relationship.id),
                  :class => 'btn btn-primary btn-mini' %></h2>
        <table class="table table-condensed">
          <thead>
            <tr>
              <th>SDFB Relationship Type Assign. ID</th>
              <th>Relationship Type</th>
              <th>Certainty</th>
              <th>Start Date Type</th>
              <th>Start Date</th>
              <th>End Date Type</th>
              <th>End Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @user_rel_contribs.each do |user_rel_contrib| %>
              <tr>
                <td><%= user_rel_contrib.id %></td>
                <td><%= user_rel_contrib.get_person1_name %> <%= link_to RelationshipType.find(user_rel_contrib.relationship_type_id).name, relationship_type_path(user_rel_contrib.relationship_type_id) %> <%= user_rel_contrib.get_person2_name %></td>
                <td><%= user_rel_contrib.certainty %>%</td>
                <td>
                <% if ! user_rel_contrib.start_date_type.blank? %>
                    <% if user_rel_contrib.start_date_type == "BF" %>
                      Before
                    <% elsif user_rel_contrib.start_date_type == "AF" %>
                      After
                    <% elsif user_rel_contrib.start_date_type == "IN" %>
                      In
                    <% elsif user_rel_contrib.start_date_type == "CA" %>
                      Circa
                    <% elsif user_rel_contrib.start_date_type == "BF/IN" %>
                      Before or In
                    <% elsif user_rel_contrib.start_date_type == "AF/IN" %>
                      After or In
                    <% end %>   
                  <% else %>
                    Unknown
                  <% end %>
                </td>
                <td>
                  <% if ((! user_rel_contrib.start_month.blank?) || (! user_rel_contrib.start_day.blank?) || (! user_rel_contrib.start_year.blank?)) %>
                    <% if ! user_rel_contrib.start_month.blank? %>
                      <%= user_rel_contrib.start_month %>
                    <% end %>  
                    <% if ! user_rel_contrib.start_day.blank? %>
                      <%= user_rel_contrib.start_day %>,
                    <% end %>
                    <% if ! user_rel_contrib.start_year.blank? %>
                      <%= user_rel_contrib.start_year %>
                    <% end %>
                  <% else %>
                    Unknown
                  <% end %>
                </td>
                <td>
                  <% if ! user_rel_contrib.end_date_type.blank? %> 
                      <% if user_rel_contrib.end_date_type == "BF" %>
                        Before
                      <% elsif user_rel_contrib.end_date_type == "AF" %>
                        After
                      <% elsif user_rel_contrib.end_date_type == "IN" %>
                        In
                      <% elsif user_rel_contrib.end_date_type == "CA" %>
                        Circa
                      <% elsif user_rel_contrib.end_date_type == "BF/IN" %>
                        Before or In
                      <% elsif user_rel_contrib.end_date_type == "AF/IN" %>
                        After or In
                      <% end %>
                      <% else %>
                    <dd>Unknown</dd>
                  <% end %>
                </td>
                
                <td>
                  <% if ((! user_rel_contrib.end_month.blank?) || (! user_rel_contrib.end_day.blank?) || (! user_rel_contrib.end_year.blank?)) %>
                  <% if ! user_rel_contrib.end_month.blank? %>
                    <%= user_rel_contrib.end_month %>
                  <% end %>  
                  <% if ! user_rel_contrib.end_day.blank? %>
                    <%= user_rel_contrib.end_day %>,
                  <% end %>
                  <% if ! user_rel_contrib.end_year.blank? %>
                    <%= user_rel_contrib.end_year %>
                  <% end %>
                  <% else %>
                    Unknown
                  <% end %>
                </td>
                <td>
                  <% if can? :show, user_rel_contrib %>
                    <%= link_to 'Show', user_rel_contrib, :class => 'btn btn-mini' %>
                  <% end %>
                  <% if user_rel_contrib.is_locked == false %>
                    <% if can? :update, user_rel_contrib %>
                      <%= link_to t('.edit', :default => t("helpers.links.edit")),
                                edit_user_rel_contrib_path(user_rel_contrib), :class => 'btn btn-mini' %>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>

      <%= will_paginate @user_rel_contribs, :param_name => 'user_rel_contribs_page', :previous_label => "Previous&nbsp;", :next_label => "&nbsp;Next" %>

      </div>
    <% else %>
      <div class="well">
        <h2>Relationship Types for <%= @relationship.get_person1_name + " & " + @relationship.get_person2_name%> <%= link_to 'Assign New Relationship Type',
                  new_user_rel_contrib_path(:relationship_id => @relationship.id),
                  :class => 'btn btn-primary btn-mini' %></h2>
        <br>
        <b>No relationship types have been assigned to this relationship.</b>
      </div>
    <% end %>
  </div>
</div>

