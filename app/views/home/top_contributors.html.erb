<%
def recent_contributions
    recent_contrib = ((Person.all_recent.all_approved.limit(1000)) + 
                      (Group.all_recent.all_approved.limit(1000)) + 
                      (Relationship.all_recent.all_approved.limit(1000)) + 
                      (GroupAssignment.all_recent.all_approved.limit(1000)) + 
                      (UserGroupContrib.all_recent.all_approved.limit(1000)) + 
                      (UserPersonContrib.all_recent.all_approved.limit(1000))) + 
                      (UserRelContrib.all_recent.all_approved.limit(1000))
    recent_contrib.sort! {|a,b| a.updated_at <=> b.updated_at}.reverse!
    @recent_contrib = recent_contrib.take(1000)
  end

# calculates, based off of the 1000 most recent contributions, which users have contributed and how much
  def recent_user_points
    users_rank = Hash.new
    @recent_contrib.each do |i|
      if users_rank.key?(i.created_by)
        users_rank[i.created_by] += 1
      else
        users_rank[i.created_by] = 1
      end
    end
    @users_rank = users_rank.sort_by { |created_by, points| points }.reverse
  end

# usernames on the leaderboard based off of id from recent_user_points
  def get_username(id)
    # user id will go through the method
    # search through all users
    # if user id == the user's id in the loop
    # return that username yay
    user = User.find([id])
    @username = user[0].username
    # @username = user.get_attribute_by_name(username)
  end
  %>

  <p id="leader-name">Top Contributors</p>
          <p id="leader-clarify">(Last 1000 Contributions)</p>
          <table id="leaderboard">
            <tr class="title">
              <th>RANK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
              <th>USERNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
              <th>PERCENTAGE</th>
            <tr>
              <% recent_contributions %>
              <% recent_user_points %>
              <% rank = 1 %>
              <% @users_rank.each do |i| %>
              <% break if rank == 11 %>
              <% if logged_in? && current_user.id == i[0] %>
                <tr class="user">
              <% else %>
                <tr>
              <% end %>
              <% get_username(i[0]) %>
                <td><%= link_to rank, user_path(i[0]) %>. </td>
                <td><%= link_to @username, user_path(i[0]) %></td>
                <td><%= link_to (i[1]/1000.0*100).round(2), user_path(i[0]) %>%</td>
                <% rank += 1 %>
            </tr>
            <% end %>

            </table>
            <p align="center"> No Recent Contributions </p>