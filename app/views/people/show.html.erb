<%- model_class = Person -%>

<div class="row">
  <div class="span4">
    <h1><%= @person.get_person_name %></h1><br>
    <dl class="dl-horizontal">
      <dt><strong>Person id:</strong></dt>
      <dd><%= @person.id %></dd>
      <% if ! @person.odnb_id.blank? %>
        <dt><strong>ODNB id:</strong></dt>
        <dd><%= @person.odnb_id %></dd>
      <% end %>
      <% if ! @person.title.blank? %>
        <dt><strong>Title:</strong></dt>
        <dd><%= @person.title %></dd>
      <% end %>
      <% if ! @person.prefix.blank? %>
        <dt><strong>Prefix:</strong></dt>
        <dd><%= @person.prefix %></dd>
      <% end %>
      <dt><strong>First name:</strong></dt>
      <dd><%= @person.first_name %></dd>
      <% if ! @person.last_name.blank? %>
        <dt><strong>Last Name:</strong></dt>
        <dd><%= @person.last_name %></dd>
      <% end %>
      <% if ! @person.suffix.blank? %>
        <dt><strong>Suffix:</strong></dt>
        <dd><%= @person.suffix %></dd>
      <% end %>
      <% if ! @person.search_names_all.blank? %>
        <dt><strong>All known identities:</strong></dt>
        <dd><%= @person.search_names_all %></dd>
      <% end %>
      <dt><strong>Created by:</strong></dt>
      <dd><%= link_to User.find(@person.created_by).username,  user_path(@person.created_by) %></dd>
      <% if ! @person.birth_year_type.blank? %>
        <dt><strong>Birth Year Type:</strong></dt>
        <dd><%= @person.birth_year_type %></dd>
      <% end %>
      <dt><strong>Extant birth year:</strong></dt>
      <dd><%= @person.ext_birth_year %></dd>
      <% if ! @person.alt_birth_year.blank? %>
        <dt><strong>Alternate birth year:</strong></dt>
        <dd><%= @person.alt_birth_year %></dd>
      <% end %>
      <dt><strong>Death Year Type:</strong></dt>
      <dd><%= @person.death_year_type %></dd>
      <dt><strong>Extant death year:</strong></dt>
      <dd><%= @person.ext_death_year %></dd>
      <% if ! @person.alt_death_year.blank? %>
        <dt><strong>Alternate death year:</strong></dt>
        <dd><%= @person.alt_death_year %></dd>
      <% end %>
      <% if ! @person.historical_significance.blank? %>
        <dt><strong>Historical Significance:</strong></dt>
        <dd><%= @person.historical_significance %></dd>
      <% end %>
      <dt><strong>Relationship Summary:</strong></dt>
      <% if ! @person.rel_sum.empty? %>
        <dd><%= @person.rel_sum %></dd>
      <% else %>
        <dd>No relationships</dd>
      <% end %>
      <dt><strong>Is Approved?:</strong></dt>
      <dd><%= @person.is_approved %></dd>
      <% if ! @person.approved_by.blank? %>
        <dt><strong>Approved by:</strong></dt>
        <dd><%= link_to User.find(@person.approved_by).username,  user_path(@person.approved_by) %></dd>
      <% end %>
      <% if ! @person.approved_on.blank? %>
        <dt><strong>Approved on:</strong></dt>
        <dd><%= @person.approved_on %></dd>
      <% end %>
      <% if ! @person.justification.blank? %>
        <dt><strong>Justification:</strong></dt>
        <dd><%= @person.justification %></dd>
      <% end %>
      <dt><strong>Created at:</strong></dt>
      <dd><%= @person.created_at %></dd>
    </dl>

    <div class="form-actions">
      <%= link_to t('.back', :default => t("helpers.links.back")),
                  people_path, :class => 'btn'  %>
      <% if can? :update, @people %> 
        <%= link_to t('.edit', :default => t("helpers.links.edit")),
                  edit_person_path(@person), :class => 'btn' %>
      <% end %>
      <% if can? :destroy, @people %> 
        <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                  person_path(@person),
                  :method => 'delete',
                  :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                  :class => 'btn btn-danger' %>
      <% end %>
    </div>
</div>
<div class="span8">
  <h1>All Relationships for <%= @person.get_person_name %></h1><br>

  <div class="well">
    <div class="container">
      <div class="row">
        <!-- <div class="span4"></div> -->
        <div class="span8">
          <b>Add a new relationship</b></br>
          <%= link_to 'New Relationship',
              new_relationship_path(:person1_id => @person.id),
              :class => 'btn btn-primary' %>
        </div>
      </div>
    </div>
  </div>

  <table class="table table-condensed">
    <thead>
      <tr>
        <th>Relationship id</th>
        <th>Person 1</th>
        <th>Person 2</th>
        <% if current_user != nil %>
            <% if (current_user.user_type == "Admin")  %>
                <th>Original Certainty</th>
            <% end %>
        <% end %>
        <th>Maximum Certainty</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th><%=t '.actions', :default => t("helpers.actions") %></th>
      </tr>
    </thead>
    <tbody>
      <% @approved_relationships.each do |relationship| %>
        <tr>
          <td><%= relationship.id %></td>
          <td><%= link_to relationship.get_person1_name, person_path(relationship.person1_index) %></td>
          <td><%= link_to relationship.get_person2_name, person_path(relationship.person2_index) %></td>
          <% if current_user != nil %>
              <% if (current_user.user_type == "Admin")  %>
                  <td><%= relationship.original_certainty %></td>
              <% end %>
          <% end %>
          <td><%= relationship.max_certainty %></td>
          <td><%= relationship.start_date %></td>
          <td><%= relationship.end_date %></td>
          <td>
            <% if can? :show, relationship %>
              <%= link_to 'Show', relationship, :class => 'btn btn-mini'  %>
            <% end %>
            <% if can? :update, relationship %>
              <%= link_to t('.edit', :default => t("helpers.links.edit")),
                          edit_relationship_path(relationship), :class => 'btn btn-mini' %>
            <% end %>
            <% if can? :destroy, relationship %>
              <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                          relationship_path(relationship),
                          :method => :delete,
                          :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                          :class => 'btn btn-mini btn-danger' %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= will_paginate @approved_relationships, :param_name => 'approved_relationships_page', :previous_label => "Previous&nbsp;", :next_label => "&nbsp;Next" %>
</div>
