/*! jQuery-Impromptu - v5.2.3 - 2014-03-09
* http://trentrichardson.com/Impromptu
* Copyright (c) 2014 Trent Richardson; Licensed MIT */
!function(t){"use strict";t.prompt=function(e,n){void 0!==n&&void 0!==n.classes&&"string"==typeof n.classes&&(n={box:n.classes}),t.prompt.options=t.extend({},t.prompt.defaults,n),t.prompt.currentPrefix=t.prompt.options.prefix,t.prompt.timeout&&clearTimeout(t.prompt.timeout),t.prompt.timeout=!1;var r=t.prompt.options,i=t(document.body),o=t(window),a='<div class="'+t.prompt.options.prefix+"box "+r.classes.box+'">';a+=r.useiframe&&t("object, applet").length>0?'<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+r.prefix+"fade "+r.classes.fade+'"></iframe>':'<div class="'+r.prefix+"fade "+r.classes.fade+'"></div>',a+='<div class="'+r.prefix+" "+r.classes.prompt+'"><form action="javascript:false;" onsubmit="return false;" class="'+r.prefix+'form"><div class="'+r.prefix+"close "+r.classes.close+'">'+r.closeText+'</div><div class="'+r.prefix+'states"></div></form></div></div>',t.prompt.jqib=t(a).appendTo(i),t.prompt.jqi=t.prompt.jqib.children("."+r.prefix),t.prompt.jqif=t.prompt.jqib.children("."+r.prefix+"fade"),e.constructor===String&&(e={state0:{title:r.title,html:e,buttons:r.buttons,position:r.position,focus:r.focus,defaultButton:r.defaultButton,submit:r.submit}}),t.prompt.options.states={};var s,u;for(s in e)u=t.extend({},t.prompt.defaults.state,{name:s},e[s]),t.prompt.addState(u.name,u),""===t.prompt.currentStateName&&(t.prompt.currentStateName=u.name);t.prompt.jqi.on("click","."+r.prefix+"buttons button",function(){var e=t(this),n=e.parents("."+r.prefix+"state"),i=t.prompt.options.states[n.data("jqi-name")],o=n.children("."+r.prefix+"message"),a=i.buttons[e.text()]||i.buttons[e.html()],s={};if(void 0===a)for(var u in i.buttons)(i.buttons[u].title===e.text()||i.buttons[u].title===e.html())&&(a=i.buttons[u].value);t.each(t.prompt.jqi.children("form").serializeArray(),function(t,e){void 0===s[e.name]?s[e.name]=e.value:typeof s[e.name]===Array||"object"==typeof s[e.name]?s[e.name].push(e.value):s[e.name]=[s[e.name],e.value]});var l=new t.Event("impromptu:submit");l.stateName=i.name,l.state=n,n.trigger(l,[a,o,s]),l.isDefaultPrevented()||t.prompt.close(!0,a,o,s)});var l=function(){if(r.persistent){var e=(""+r.top).indexOf("%")>=0?o.height()*(parseInt(r.top,10)/100):parseInt(r.top,10),n=parseInt(t.prompt.jqi.css("top").replace("px",""),10)-e;t("html,body").animate({scrollTop:n},"fast",function(){var e=0;t.prompt.jqib.addClass(r.prefix+"warning");var n=setInterval(function(){t.prompt.jqib.toggleClass(r.prefix+"warning"),e++>1&&(clearInterval(n),t.prompt.jqib.removeClass(r.prefix+"warning"))},100)})}else t.prompt.close(!0)},c=function(e){var n=window.event?event.keyCode:e.keyCode;if(27===n&&l(),13===n){var i=t.prompt.getCurrentState().find("."+r.prefix+"defaultbutton"),o=t(e.target);o.is("textarea,."+r.prefix+"button")===!1&&i.length>0&&(e.preventDefault(),i.click())}if(9===n){var a=t("input,select,textarea,button",t.prompt.getCurrentState()),s=!e.shiftKey&&e.target===a[a.length-1],u=e.shiftKey&&e.target===a[0];if(s||u)return setTimeout(function(){if(a){var t=a[u===!0?a.length-1:0];t&&t.focus()}},10),!1}};return t.prompt.position(),t.prompt.style(),t.prompt.jqif.click(l),o.resize({animate:!1},t.prompt.position),t.prompt.jqi.find("."+r.prefix+"close").click(t.prompt.close),t.prompt.jqib.on("keydown",c).on("impromptu:loaded",r.loaded).on("impromptu:close",r.close).on("impromptu:statechanging",r.statechanging).on("impromptu:statechanged",r.statechanged),t.prompt.jqif[r.show](r.overlayspeed),t.prompt.jqi[r.show](r.promptspeed,function(){var e=t.prompt.jqi.find("."+r.prefix+"states ."+r.prefix+"state").eq(0);t.prompt.goToState(e.data("jqi-name")),t.prompt.jqib.trigger("impromptu:loaded")}),r.timeout>0&&(t.prompt.timeout=setTimeout(function(){t.prompt.close(!0)},r.timeout)),t.prompt.jqib},t.prompt.defaults={prefix:"jqi",classes:{box:"",fade:"",prompt:"",close:"",title:"",message:"",buttons:"",button:"",defaultButton:""},title:"",closeText:"&times;",buttons:{Ok:!0},loaded:function(){},submit:function(){},close:function(){},statechanging:function(){},statechanged:function(){},opacity:.6,zIndex:999,overlayspeed:"slow",promptspeed:"fast",show:"fadeIn",focus:0,defaultButton:0,useiframe:!1,top:"15%",position:{container:null,x:null,y:null,arrow:null,width:null},persistent:!0,timeout:0,states:{},state:{name:null,title:"",html:"",buttons:{Ok:!0},focus:0,defaultButton:0,position:{container:null,x:null,y:null,arrow:null,width:null},submit:function(){return!0}}},t.prompt.currentPrefix=t.prompt.defaults.prefix,t.prompt.currentStateName="",t.prompt.setDefaults=function(e){t.prompt.defaults=t.extend({},t.prompt.defaults,e)},t.prompt.setStateDefaults=function(e){t.prompt.defaults.state=t.extend({},t.prompt.defaults.state,e)},t.prompt.position=function(e){var n=t.fx.off,r=t.prompt.getCurrentState(),i=t.prompt.options.states[r.data("jqi-name")],o=i?i.position:void 0,a=t(window),s=document.body.scrollHeight,u=t(window).height(),l=(t(document).height(),s>u?s:u),c=parseInt(a.scrollTop(),10)+((""+t.prompt.options.top).indexOf("%")>=0?u*(parseInt(t.prompt.options.top,10)/100):parseInt(t.prompt.options.top,10));if(void 0!==e&&e.data.animate===!1&&(t.fx.off=!0),t.prompt.jqib.css({position:"absolute",height:l,width:"100%",top:0,left:0,right:0,bottom:0}),t.prompt.jqif.css({position:"fixed",height:l,width:"100%",top:0,left:0,right:0,bottom:0}),o&&o.container){var f=t(o.container).offset();t.isPlainObject(f)&&void 0!==f.top&&(t.prompt.jqi.css({position:"absolute"}),t.prompt.jqi.animate({top:f.top+o.y,left:f.left+o.x,marginLeft:0,width:void 0!==o.width?o.width:null}),c=f.top+o.y-((""+t.prompt.options.top).indexOf("%")>=0?u*(parseInt(t.prompt.options.top,10)/100):parseInt(t.prompt.options.top,10)),t("html,body").animate({scrollTop:c},"slow","swing",function(){}))}else o&&o.width?(t.prompt.jqi.css({position:"absolute",left:"50%"}),t.prompt.jqi.animate({top:o.y||c,left:o.x||"50%",marginLeft:-1*(o.width/2),width:o.width})):t.prompt.jqi.css({position:"absolute",top:c,left:"50%",marginLeft:-1*(t.prompt.jqi.outerWidth(!1)/2)});void 0!==e&&e.data.animate===!1&&(t.fx.off=n)},t.prompt.style=function(){t.prompt.jqif.css({zIndex:t.prompt.options.zIndex,display:"none",opacity:t.prompt.options.opacity}),t.prompt.jqi.css({zIndex:t.prompt.options.zIndex+1,display:"none"}),t.prompt.jqib.css({zIndex:t.prompt.options.zIndex})},t.prompt.get=function(){return t("."+t.prompt.currentPrefix)},t.prompt.addState=function(e,n,r){var i,o,a,s="",u=null,l="",c="",f=t.prompt.options,h=t("."+t.prompt.currentPrefix+"states"),p=0;n=t.extend({},t.prompt.defaults.state,{name:e},n),null!==n.position.arrow&&(l='<div class="'+f.prefix+"arrow "+f.prefix+"arrow"+n.position.arrow+'"></div>'),n.title&&""!==n.title&&(c='<div class="lead '+f.prefix+"title "+f.classes.title+'">'+n.title+"</div>"),s+='<div id="'+f.prefix+"state_"+e+'" class="'+f.prefix+'state" data-jqi-name="'+e+'" style="display:none;">'+l+c+'<div class="'+f.prefix+"message "+f.classes.message+'">'+n.html+'</div><div class="'+f.prefix+"buttons "+f.classes.buttons+'"'+(t.isEmptyObject(n.buttons)?'style="display:none;"':"")+">";for(o in n.buttons)a=n.buttons[o],i=n.focus===p||isNaN(n.focus)&&n.defaultButton===p?t.prompt.currentPrefix+"defaultbutton "+f.classes.defaultButton:"","object"==typeof a?(s+='<button class="'+f.classes.button+" "+t.prompt.currentPrefix+"button "+i,void 0!==a.classes&&(s+=" "+(t.isArray(a.classes)?a.classes.join(" "):a.classes)+" "),s+='" name="'+f.prefix+"_"+e+"_button"+a.title.replace(/[^a-z0-9]+/gi,"")+'" id="'+f.prefix+"_"+e+"_button"+a.title.replace(/[^a-z0-9]+/gi,"")+'" value="'+a.value+'">'+a.title+"</button>"):s+='<button class="'+t.prompt.currentPrefix+"button "+f.classes.button+" "+i+'" name="'+f.prefix+"_"+e+"_button"+o.replace(/[^a-z0-9]+/gi,"")+'" id="'+f.prefix+"_"+e+"_button"+o.replace(/[^a-z0-9]+/gi,"")+'" value="'+a+'">'+o+"</button>",p++;return s+="</div></div>",u=t(s),u.on("impromptu:submit",n.submit),void 0!==r?h.find("#"+t.prompt.currentPrefix+"state_"+r).after(u):h.append(u),t.prompt.options.states[e]=n,u},t.prompt.removeState=function(e){var n=t.prompt.getState(e),r=function(){n.remove()};return 0===n.length?!1:("none"!==n.css("display")?n.next().length>0?t.prompt.nextState(r):t.prompt.prevState(r):n.slideUp("slow",r),!0)},t.prompt.getState=function(e){return t("#"+t.prompt.currentPrefix+"state_"+e)},t.prompt.getStateContent=function(e){return t.prompt.getState(e)},t.prompt.getCurrentState=function(){return t.prompt.getState(t.prompt.getCurrentStateName())},t.prompt.getCurrentStateName=function(){return t.prompt.currentStateName},t.prompt.goToState=function(e,n,r){var i=(t.prompt.get(),t.prompt.options),o=t.prompt.getState(e),a=i.states[o.data("jqi-name")],s=new t.Event("impromptu:statechanging");return"function"==typeof n&&(r=n,n=!1),t.prompt.jqib.trigger(s,[t.prompt.getCurrentStateName(),e]),!s.isDefaultPrevented()&&o.length>0&&(t.prompt.jqi.find("."+t.prompt.currentPrefix+"parentstate").removeClass(t.prompt.currentPrefix+"parentstate"),n?(t.prompt.jqi.find("."+t.prompt.currentPrefix+"substate").not(o).slideUp(i.promptspeed).removeClass("."+t.prompt.currentPrefix+"substate").find("."+t.prompt.currentPrefix+"arrow").hide(),t.prompt.jqi.find("."+t.prompt.currentPrefix+"state:visible").addClass(t.prompt.currentPrefix+"parentstate"),o.addClass(t.prompt.currentPrefix+"substate")):t.prompt.jqi.find("."+t.prompt.currentPrefix+"state").not(o).slideUp(i.promptspeed).find("."+t.prompt.currentPrefix+"arrow").hide(),t.prompt.currentStateName=a.name,o.slideDown(i.promptspeed,function(){var n=t(this);"string"==typeof a.focus?n.find(a.focus).eq(0).focus():n.find("."+t.prompt.currentPrefix+"defaultbutton").focus(),n.find("."+t.prompt.currentPrefix+"arrow").show(i.promptspeed),"function"==typeof r&&t.prompt.jqib.on("impromptu:statechanged",r),t.prompt.jqib.trigger("impromptu:statechanged",[e]),"function"==typeof r&&t.prompt.jqib.off("impromptu:statechanged",r)}),n||t.prompt.position()),o},t.prompt.nextState=function(e){var n=t("#"+t.prompt.currentPrefix+"state_"+t.prompt.getCurrentStateName()).next();return n.length>0&&t.prompt.goToState(n.attr("id").replace(t.prompt.currentPrefix+"state_",""),e),n},t.prompt.prevState=function(e){var n=t("#"+t.prompt.currentPrefix+"state_"+t.prompt.getCurrentStateName()).prev();return n.length>0&&t.prompt.goToState(n.attr("id").replace(t.prompt.currentPrefix+"state_",""),e),n},t.prompt.close=function(e,n,r,i){t.prompt.timeout&&(clearTimeout(t.prompt.timeout),t.prompt.timeout=!1),t.prompt.jqib&&t.prompt.jqib.fadeOut("fast",function(){t.prompt.jqib.trigger("impromptu:close",[n,r,i]),t.prompt.jqib.remove(),t(window).off("resize",t.prompt.position)})},t.fn.prompt=function(e){void 0===e&&(e={}),void 0===e.withDataAndEvents&&(e.withDataAndEvents=!1),t.prompt(t(this).clone(e.withDataAndEvents).html(),e)}}(jQuery);