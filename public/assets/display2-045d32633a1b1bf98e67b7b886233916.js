function createGroup(){this.id=null,this.name=null,this.nodes=null}function getClusterBirth(t){if(parseInt(t)<1550)return 0;if(parseInt(t)>1700)return 1;var e=Math.round((parseInt(t)-1550)/5);return 2+e}function getColorsBirth(){return{0:"#A6D9CA",1:"#F0623E",2:"#B99CCA",3:"#B8DCF4",4:"#F9F39C",5:"#339998",6:"#6566AD",7:"#F89939",8:"#558FCB",9:"#04A287",10:"#B53C84",11:"#F2805C",12:"#79BD90",13:"#654B9E",14:"#DD88B8",15:"#3D58A6",16:"#EF4C3A",17:"#99CC7D",18:"#4D6AB2",19:"#A1D7D0",20:"#FABC3E",21:"#EE6096",22:"#DADC44",23:"#B177B3",24:"#A573B1",25:"#78CDD6",26:"#60BD6D",27:"#3EA7C0",28:"#F59485",29:"#3F6FB6",30:"#F8EC49",31:"#1C57A7"}}function getClusterRels(t){var e=t.size;return e>11?6:Math.floor(e/2)}function getColorsRels(){return{0:"#f56046",1:"#ffbb12",2:"#73cab5",3:"#1d7578",4:"#b6dcf2",5:"#ff00ff",6:"#9954e2"}}function notInArray(t,e){for(var n=t.length;n--;){if(t[n][0]==e[0]&&t[n][1]==e[1])return!1;if(t[n][1]==e[0]&&t[n][0]==e[1])return!1}return!0}function showNodeInfo(t,e){accordion("node"),$("#node-name").text(t.first+" "+t.last),$("#node-bdate").text(t.birth),$("#node-ddate").text(t.death),$("#node-significance").text(t.occupation),$("#node-group").text(e);var n=new Date;$("#node-cite").text(t.first+" "+t.last+" Network Visualization. \n Six Degrees of Francis Bacon: Reassembling the Early Modern Social Network. Gen. eds. Daniel Shore and Christopher Warren. "+n.getMonth()+"/"+n.getDate()+"/"+n.getFullYear()+" <http://sixdegreesoffrancisbacon.com/>"),t.odnb_id>0?$("#node-DNBlink").attr("href","http://www.oxforddnb.com/view/article/"+t.odnb_id):$("#node-DNBlink").attr("href","http://www.oxforddnb.com/search/quick/?quicksearch=quicksearch&docPos=1&searchTarget=people&simpleName="+t.first+"+"+t.last),$("#node-GoogleLink").attr("href","http://www.google.com/search?q="+t.first+"+"+t.last),$("#node-discussion").attr("href","/people/"+t.id),$("#node-icon-chain").attr("href","/relationships/new?person1_id="+t.id),$("#node-icon-annotate").attr("href","/user_person_contribs/new?person_id="+t.id)}function createNodeKey(t){var e={text:t.first+" "+t.last,size:4,id:t.id,cluster:getClusterRels(t)};return e}function peopletoarray(t){keys=[];for(var e in t.nodes)keys.push(t.nodes[e].first+" "+t.nodes[e].last+" ("+t.nodes[e].birth+")");return keys}function idstoarray(t){keys=[];for(var e in t.nodes)keys.push(t.nodes[e].id);return keys}function birthtoarray(t){keys=[];for(var e in t.nodes)keys.push(t.nodes[e].birth);return keys}function twoDegs(t,e,n,i,o,r){function s(t,e,n,i,o){var r=e.nodes[t];r.rels.length>0&&($.each(r.rels,function(t,s){if(0==s[2]||s[1]<n||i>h[d.indexOf(s[0])]||o<h[d.indexOf(s[0])])console.log("merp");else{var a=e.nodes[s[0]];l[a.id]=createNodeKey(a),notInArray(u,[r.id,a.id])&&u.push([r.id,a.id])}}),l[r.id]={text:r.first+" "+r.last,size:20,id:r.id,cluster:getClusterRels(r)})}function a(t,e){var n=[];for(var i in e.groups)e.groups[i].nodes.indexOf(t.id)>-1&&n.push(e.groups[i].name);var o=n.join(", ");return o}var l={},c=[],u=[],d=idstoarray(n),h=birthtoarray(n);s(t,n,i,o,r),0!=e&&""!=e&&s(e,n,i,o,r),$.each(l,function(t,e){c.push(e)}),u.reverse();var p=window.innerWidth,f=window.innerHeight,m={width:p,height:f,collisionAlpha:10,colors:getColorsRels()},g=new Insights($("#graph")[0],c,u,m).render();g.focus(t),g.on("node:click",function(t){var e=n.nodes[t.id];showNodeInfo(e,a(e,n))}),g.on("edge:click",function(t){Pace.restart();var e=parseInt(t.source.id),i=parseInt(t.target.id);getAnnotation(i>e?e:i,e>i?e:i,n)}),g.tooltip("<div class='btn' >{{text}}</div>"),$("#zoom button.icon").click(function(){"in"==this.name?(g.zoomIn(),g.center()):"out"==this.name&&(g.zoomOut(),g.center())})}function getConfidence(t){return 19>=(t>=0)?"very unlikely":39>=(t>=20)?"unlikely":59>=(t>=40)?"possible":79>=(t>=60)?"likely":100>=(t>=80)?"certain":void 0}function getAnnotation(t,e,n){var i=n.nodes[t].rels,o="",r="";return $.each(i,function(t,n){n[0]==e&&(o=getConfidence(n[1])+" @ "+n[1]+"%",r=n[3])}),accordion("edge"),$("#edge-nodes").html(n.nodes[t].first+" "+n.nodes[t].last+" & "+n.nodes[e].first+" "+n.nodes[e].last),$("#edge-confidence").html(o),$("#edge-discussion").attr("href","/relationships/"+r),$("#edge-icon-annotate").attr("href","/user_rel_contribs/new?relationship_id="+r),!0}function populateLists(t){var e=peopletoarray(t);$("#one").typeahead({local:e.sort()}),$("#two").typeahead({local:e.sort()}),$("#three").typeahead({local:e.sort()}),$("#entry_768090773").typeahead({local:e.sort()}),$("#entry_1321382891").typeahead({local:e.sort()}),$("#entry_1177061505").typeahead({local:e.sort()}),$("#four").typeahead({local:Object.keys(t.groups_names).sort()}),$("#five").typeahead({local:Object.keys(t.groups_names).sort()}),$("#six").typeahead({local:Object.keys(t.groups_names).sort()}),$("#entry_110233074").typeahead({local:Object.keys(t.groups_names).sort()})}function getParam(t){var e=location.search.substr(location.search.indexOf("?")+1),n="";e=e.split("&");for(var i=0;i<e.length;i++)temp=e[i].split("="),[temp[0]]==t&&(n=temp[1]);return n}function filterGraph(t){var e=getParam("id"),n=getParam("id2"),i=getParam("confidence"),o=getParam("date"),r=o.substring(0,3),s=o.substring(5,8);(""==n||"0"==n)&&(n=0),""==o&&(r=default_sdate,s=default_edate),""==e&&(e=francisID),""==i&&(i=default_confidence),twoDegs(e,n,t,i,r,s)}function initGraph(t,e){var n=peopletoarray(e),i=idstoarray(e);$("#findonenode").click(function(){var t="no";if(Pace.restart(),$("#one").val())var e=n.indexOf($("#one").val());1==$("#show-table").val()&&(t="yes");var o=$("#slider-result-hidden1").val(),r=$("#search-date-range1").val().split(" - ");window.location.href="/?id="+i[e]+"&confidence="+o+"&date="+r+"&table="+t}),$("#findtwonode").click(function(){var t="no";if(Pace.restart(),$("#two").val())var e=n.indexOf($("#two").val());if($("#three").val())var o=n.indexOf($("#three").val());1==$("#show-table").val()&&(t="yes");var r=$("#slideredge-result-hidden2").val(),s=$("#searchedge-date-range2").val().split(" - ");window.location.href="/?id="+i[e]+"&id2="+i[o]+"&confidence="+r+"&date="+s+"&table="+t}),$("#nav-filter").click(function(){var t=getParam("id"),e=$("#slidenav-result-hidden1").val(),n=$("#nav-date-range2").val().split(" - ");""!=t&&(window.location.href="/?id="+t+"&confidence="+e+"&date="+n),""==t&&(window.location.href="/?id="+francisID+"&confidence="+e+"&date="+n)}),$("#findonegroup").click(function(){$("#four").val()&&(Pace.restart(),showOneGroup($("#four").val(),t),$("#twogroupsmenu").css("display","none"))}),$("#findtwogroup").click(function(){$("#five").val()&&$("#six").val()&&(Pace.restart(),$("#group1").html($("#five").val()),$("#group3").html($("#six").val()),findInterGroup($("#group1").html(),$("#group3").html(),t))}),$("#group1").click(function(){showOneGroup($("#group1").html(),t)}),$("#group3").click(function(){showOneGroup($("#group3").html(),t)}),$("#group2").click(function(){findInterGroup($("#group1").html(),$("#group3").html(),t)}),$("#submitnode").click(function(){Pace.restart();var t=$("#entry_1804360896").val()+" "+$("#entry_754797571").val(),e=$("#entry_524366257").val();$("section").css("display","none"),$("#addedgeform").css("display","block"),$("#entry_768090773").val(t+" ("+e+")"),$("#graph").html(""),$("#results").html(""),addNodes=[],addEdges=[],addNodes.push({id:0,text:t,size:14,cluster:getCluster(e)});var n={width:$("#graph").width(),height:$("#graph").height(),colors:getColors()},i=(new Insights($("#graph")[0],addNodes,[],n).render(),"https://docs.google.com/spreadsheets/d/1-faviCW5k2v7DVOHpSQT-grRqNU1lBVkUjJEVfOvSs8/edit#gid=688870062");$.prompt("Thank you for your person contribution! You can review your submission by going to <a href='"+i+"' target='_blank'>link</a>")}),$("#submitedge").click(function(){Pace.restart();var e=t.nodes_names[$("#entry_1321382891").val()],n=t.nodes[e];if(!n.id)return void window.alert("Incorrect information. Please try again.");if(0!=addNodes.length){$("#graph").html(""),$("#results").html(""),addNodes.push({id:n.id,text:n.label,size:4,cluster:getCluster(n.birth)}),addEdges.push([0,n.id]);var i={width:$("#graph").width(),height:$("#graph").height(),colors:getColors()},o=(new Insights($("#graph")[0],addNodes,addEdges,i).render(),"https://docs.google.com/spreadsheets/d/1cu7hpYQMWTO8C7F8V34BEbdB2NrUe1xsslWKoai3BWE/edit#gid=51712082");$.prompt("Thank you for your annotated relationship contribution! You can review your submission by going to <a href='"+o+"' target='_blank'>link</a>")}}),$("aside button.icon").click(function(){addNodes=[],addEdges=[];var t=$("#node-name").html()+" ("+$("#node-bdate").html()+")";"icon-tag"==this.id?$("#entry_1177061505").val(t):"icon-link"==this.id&&$("#entry_768090773").val(t)})}function init(){var t=gon.people,e={nodes:[],edges:[],groups_names:[],nodeKeys:[]};$.each(t,function(t,n){var i=new node;i.id=n.id,i.first=n.first_name,i.last=n.last_name,i.label=i.first+" "+i.last,i.birth=n.ext_birth_year,i.death=n.ext_death_year,i.occupation=n.historical_significance,i.rels=n.rel_sum,i.size=i.rels.length,i.odnb_id=n.odnb_id,e.nodes[i.id]=i}),filterGraph(e)}var francisID=10000473,default_confidence=40,default_sdate=1400,default_edate=1800,node=function(){this.id=null,this.first=null,this.last=null,this.birth=null,this.death=null,this.label=null,this.name=null,this.occupation=null,this.edges=[],this.key=null,this.rels=0,this.size=0};$("#zoom button.icon").click(function(){"in"==this.name?graph.zoomIn():graph.zoomOut()}),$(document).ready(function(){init()});