function getClusterRels(e){var t=e.size;return t>100?10:Math.floor(t/2)/10}function getColorsRels(){return{0:"#f56046",1:"#ffbb12",2:"#73cab5",3:"#1d7578",4:"#b6dcf2",5:"#ff00ff",6:"#9954e2"}}function notInArray(e,t){for(var n=e.length;n--;){if(e[n][0]==t[0]&&e[n][1]==t[1])return!1;if(e[n][1]==t[0]&&e[n][0]==t[1])return!1}return!0}function showNodeInfo(e){accordion("node"),$("#node-name").text(e.first+" "+e.last),$("#node-bdate").text(e.birth),$("#node-ddate").text(e.death),$("#node-significance").text(e.occupation),$("#node-group").text(e.groups.join(",")),console.log("HI"+e.groups);var t=new Date;$("#node-cite").text(e.first+" "+e.last+" Network Visualization. \n Six Degrees of Francis Bacon: Reassembling the Early Modern Social Network. Gen. eds. Daniel Shore and Christopher Warren. "+t.getMonth()+"/"+t.getDate()+"/"+t.getFullYear()+" <http://sixdegreesoffrancisbacon.com/>"),e.odnb_id>0?$("#node-DNBlink").attr("href","http://www.oxforddnb.com/view/article/"+e.odnb_id):$("#node-DNBlink").attr("href","http://www.oxforddnb.com/search/quick/?quicksearch=quicksearch&docPos=1&searchTarget=people&simpleName="+e.first+"+"+e.last),$("#node-GoogleLink").attr("href","http://www.google.com/search?q="+e.first+"+"+e.last),$("#node-discussion").attr("href","/people/"+e.id),$("#node-icon-chain").attr("href","/relationships/new?person1_id="+e.id),$("#node-icon-annotate").attr("href","/user_person_contribs/new?person_id="+e.id)}function createNodeKey(e){var t={text:e.first+" "+e.last,size:4,id:e.id,cluster:getClusterRels(e)};return t}function peopletoarray(e){keys=[];for(var t in e.nodes)keys.push(e.nodes[t].first+" "+e.nodes[t].last+" ("+e.nodes[t].birth+")");return keys}function idstoarray(e){keys=[];for(var t in e.nodes)keys.push(e.nodes[t].id);return keys}function birthtoarray(e){keys=[];for(var t in e.nodes)keys.push(e.nodes[t].birth);return keys}function twoDegs(e,t,n,i,a,o){function r(e,t,n,i,a){var o=t.nodes[e];console.log(t,e,n,i,a),$.each(o.rels,function(e,r){if(0==r[2]||r[1]<n||i>u[c.indexOf(r[0])]||a<u[c.indexOf(r[0])]);else{var l=t.nodes[r[0]];s[l.id]=createNodeKey(l),notInArray(d,[o.id,l.id])&&d.push([o.id,l.id])}}),s[o.id]={text:o.first+" "+o.last,size:20,id:o.id,cluster:getClusterRels(o)}}var s={},l=[],d=[],c=idstoarray(n),u=birthtoarray(n);console.log("merp"),r(e,n,i,a,o),0!=t&&""!=t&&r(t,n,i,a,o),$.each(s,function(e,t){l.push(t)}),d.reverse();var h=window.innerWidth,p=window.innerHeight,f={width:h,height:p,collisionAlpha:10,colors:getColorsRels()},m=new Insights($("#graph")[0],l,d,f).render();m.focus(e),m.on("node:click",function(e){var t=n.nodes[e.id];showNodeInfo(t)}),m.on("edge:click",function(e){var t=parseInt(e.source.id),i=parseInt(e.target.id);getAnnotation(i>t?t:i,t>i?t:i,n)}),m.tooltip("<div class='btn' >{{text}}</div>"),$("#zoom button.icon").click(function(){"in"==this.name?(m.zoomIn(),m.center()):"out"==this.name&&(m.zoomOut(),m.center())})}function getConfidence(e){return e>=0&&19>=e?"very unlikely":e>=20&&39>=e?"unlikely":e>=40&&59>=e?"possible":e>=60&&79>=e?"likely":"certain"}function getAnnotation(e,t,n){var i=n.nodes[e].rels,a="",o="";return $.each(i,function(e,n){n[0]==t&&(a=getConfidence(n[1])+" @ "+n[1]+"%",o=n[3])}),accordion("edge"),$("#edge-nodes").html(n.nodes[e].first+" "+n.nodes[e].last+" & "+n.nodes[t].first+" "+n.nodes[t].last),$("#edge-confidence").html(a),$("#edge-discussion").attr("href","/relationships/"+o),$("#edge-icon-annotate").attr("href","/user_rel_contribs/new?relationship_id="+o),!0}function populateLists(e){peopletoarray(e);$("#group_name").typeahead({local:e.groups_names}).on("typeahead:selected",function(t,n){$("#group-description").html(e.groups_desc[e.groups_names.indexOf(n.value)]),$("#group-members").html(e.groups_people[e.groups_names.indexOf(n.value)].toString())})}function getParam(e){var t=location.search.substr(location.search.indexOf("?")+1),n="";t=t.split("&");for(var i=0;i<t.length;i++)temp=t[i].split("="),[temp[0]]==e&&(n=temp[1]);return n}function filterGraph(e){var t=getParam("id"),n=getParam("id2"),i=getParam("confidence"),a=getParam("date"),o=a.substring(0,3),r=a.substring(5,8);(""==n||"0"==n)&&(n=0),""==a&&(o=default_sdate,r=default_edate),""==t&&(t=francisID),""==i&&(i=default_confidence),twoDegs(t,n,e,i,o,r)}function initGraph(e){var t=peopletoarray(e),n=idstoarray(e);getParam("id")>0&&$("#results").html("Two degrees of "+t[n.indexOf(parseInt(getParam("id")))]+" at "+getParam("confidence")+"% from "+getParam("date").replace(","," to ")),$("#findonenode").click(function(){var e="no";Pace.restart();var t=$("#one_node_id_field").val();1==$("#show-table").val()&&(e="yes");var n=$("#slider-result-hidden1").val(),i=$("#search-date-hidden1").val().split(" - ");window.location.href="/?id="+t+"&confidence="+n+"&date="+i+"&table="+e}),$("#findtwonode").click(function(){var e="no";if(Pace.restart(),$("#two").val())var i=t.indexOf($("#two").val());if($("#three").val())var a=t.indexOf($("#three").val());1==$("#show-table").val()&&(e="yes");var o=$("#slideredge-result-hidden2").val(),r=$("#searchedge-date-hidden2").val().split(" - ");window.location.href="/?id="+n[i]+"&id2="+n[a]+"&confidence="+o+"&date="+r+"&table="+e}),$("#nav-filter").click(function(){var e=getParam("id"),t=$("#slidenav-result-hidden1").val(),n=$("#nav-date-range2").val().split(" - ");""!=e&&(window.location.href="/?id="+e+"&confidence="+t+"&date="+n),""==e&&(window.location.href="/?id="+francisID+"&confidence="+t+"&date="+n)}),$("aside button.icon").click(function(){addNodes=[],addEdges=[];var e=$("#node-name").html()+" ("+$("#node-bdate").html()+")";"icon-tag"==this.id?$("#entry_1177061505").val(e):"icon-link"==this.id&&$("#entry_768090773").val(e)})}function init(){var e={nodes:[],edges:[],groups_names:[],groups_desc:[],groups_people:[],nodeKeys:[]},t=window.gon.people,n=window.gon.group_data;if("object"===jQuery.type(t)){var i=new node;i.id=t.id,i.first=t.first_name,i.last=t.last_name,i.label=i.first+" "+i.last,i.birth=t.ext_birth_year,i.death=t.ext_death_year,i.occupation=t.historical_significance,i.rels=t.rel_sum,i.size=i.rels.length,i.odnb_id=t.odnb_id,i.groups=t.group_list,e.nodes[i.id]=i}else console.log(t),$.each(t,function(t,n){var i=new node;i.id=n.id,i.first=n.first_name,i.last=n.last_name,i.label=i.first+" "+i.last,i.birth=n.ext_birth_year,i.death=n.ext_death_year,i.occupation=n.historical_significance,i.rels=n.rel_sum,i.size=i.rels.length,i.odnb_id=n.odnb_id,i.groups=n.group_list,e.nodes[i.id]=i});$.each(n,function(t,n){e.groups_names.push(n.name),e.groups_desc.push(n.description),e.groups_people.push(n.person_list)}),populateLists(e),filterGraph(e),initGraph(e)}var francisID=10000473,default_confidence=40,default_sdate=1400,default_edate=1800,node=function(){this.id=null,this.first=null,this.last=null,this.birth=null,this.death=null,this.groups=null,this.label=null,this.name=null,this.occupation=null,this.edges=[],this.key=null,this.rels=0,this.size=0};$("#zoom button.icon").click(function(){"in"==this.name?graph.zoomIn():graph.zoomOut()}),$(document).ready(function(){init()});