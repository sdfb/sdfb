/*! jQuery-Impromptu - v5.2.3 - 2014-03-09
* http://trentrichardson.com/Impromptu
* Copyright (c) 2014 Trent Richardson; Licensed MIT */
!function(e){"use strict";e.prompt=function(t,n){void 0!==n&&void 0!==n.classes&&"string"==typeof n.classes&&(n={box:n.classes}),e.prompt.options=e.extend({},e.prompt.defaults,n),e.prompt.currentPrefix=e.prompt.options.prefix,e.prompt.timeout&&clearTimeout(e.prompt.timeout),e.prompt.timeout=!1;var r=e.prompt.options,i=e(document.body),o=e(window),s='<div class="'+e.prompt.options.prefix+"box "+r.classes.box+'">';s+=r.useiframe&&e("object, applet").length>0?'<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+r.prefix+"fade "+r.classes.fade+'"></iframe>':'<div class="'+r.prefix+"fade "+r.classes.fade+'"></div>',s+='<div class="'+r.prefix+" "+r.classes.prompt+'"><form action="javascript:false;" onsubmit="return false;" class="'+r.prefix+'form"><div class="'+r.prefix+"close "+r.classes.close+'">'+r.closeText+'</div><div class="'+r.prefix+'states"></div></form></div></div>',e.prompt.jqib=e(s).appendTo(i),e.prompt.jqi=e.prompt.jqib.children("."+r.prefix),e.prompt.jqif=e.prompt.jqib.children("."+r.prefix+"fade"),t.constructor===String&&(t={state0:{title:r.title,html:t,buttons:r.buttons,position:r.position,focus:r.focus,defaultButton:r.defaultButton,submit:r.submit}}),e.prompt.options.states={};var a,u;for(a in t)u=e.extend({},e.prompt.defaults.state,{name:a},t[a]),e.prompt.addState(u.name,u),""===e.prompt.currentStateName&&(e.prompt.currentStateName=u.name);e.prompt.jqi.on("click","."+r.prefix+"buttons button",function(){var t=e(this),n=t.parents("."+r.prefix+"state"),i=e.prompt.options.states[n.data("jqi-name")],o=n.children("."+r.prefix+"message"),s=i.buttons[t.text()]||i.buttons[t.html()],a={};if(void 0===s)for(var u in i.buttons)(i.buttons[u].title===t.text()||i.buttons[u].title===t.html())&&(s=i.buttons[u].value);e.each(e.prompt.jqi.children("form").serializeArray(),function(e,t){void 0===a[t.name]?a[t.name]=t.value:typeof a[t.name]===Array||"object"==typeof a[t.name]?a[t.name].push(t.value):a[t.name]=[a[t.name],t.value]});var l=new e.Event("impromptu:submit");l.stateName=i.name,l.state=n,n.trigger(l,[s,o,a]),l.isDefaultPrevented()||e.prompt.close(!0,s,o,a)});var l=function(){if(r.persistent){var t=(""+r.top).indexOf("%")>=0?o.height()*(parseInt(r.top,10)/100):parseInt(r.top,10),n=parseInt(e.prompt.jqi.css("top").replace("px",""),10)-t;e("html,body").animate({scrollTop:n},"fast",function(){var t=0;e.prompt.jqib.addClass(r.prefix+"warning");var n=setInterval(function(){e.prompt.jqib.toggleClass(r.prefix+"warning"),t++>1&&(clearInterval(n),e.prompt.jqib.removeClass(r.prefix+"warning"))},100)})}else e.prompt.close(!0)},c=function(t){var n=window.event?event.keyCode:t.keyCode;if(27===n&&l(),13===n){var i=e.prompt.getCurrentState().find("."+r.prefix+"defaultbutton"),o=e(t.target);o.is("textarea,."+r.prefix+"button")===!1&&i.length>0&&(t.preventDefault(),i.click())}if(9===n){var s=e("input,select,textarea,button",e.prompt.getCurrentState()),a=!t.shiftKey&&t.target===s[s.length-1],u=t.shiftKey&&t.target===s[0];if(a||u)return setTimeout(function(){if(s){var e=s[u===!0?s.length-1:0];e&&e.focus()}},10),!1}};return e.prompt.position(),e.prompt.style(),e.prompt.jqif.click(l),o.resize({animate:!1},e.prompt.position),e.prompt.jqi.find("."+r.prefix+"close").click(e.prompt.close),e.prompt.jqib.on("keydown",c).on("impromptu:loaded",r.loaded).on("impromptu:close",r.close).on("impromptu:statechanging",r.statechanging).on("impromptu:statechanged",r.statechanged),e.prompt.jqif[r.show](r.overlayspeed),e.prompt.jqi[r.show](r.promptspeed,function(){var t=e.prompt.jqi.find("."+r.prefix+"states ."+r.prefix+"state").eq(0);e.prompt.goToState(t.data("jqi-name")),e.prompt.jqib.trigger("impromptu:loaded")}),r.timeout>0&&(e.prompt.timeout=setTimeout(function(){e.prompt.close(!0)},r.timeout)),e.prompt.jqib},e.prompt.defaults={prefix:"jqi",classes:{box:"",fade:"",prompt:"",close:"",title:"",message:"",buttons:"",button:"",defaultButton:""},title:"",closeText:"&times;",buttons:{Ok:!0},loaded:function(){},submit:function(){},close:function(){},statechanging:function(){},statechanged:function(){},opacity:.6,zIndex:999,overlayspeed:"slow",promptspeed:"fast",show:"fadeIn",focus:0,defaultButton:0,useiframe:!1,top:"15%",position:{container:null,x:null,y:null,arrow:null,width:null},persistent:!0,timeout:0,states:{},state:{name:null,title:"",html:"",buttons:{Ok:!0},focus:0,defaultButton:0,position:{container:null,x:null,y:null,arrow:null,width:null},submit:function(){return!0}}},e.prompt.currentPrefix=e.prompt.defaults.prefix,e.prompt.currentStateName="",e.prompt.setDefaults=function(t){e.prompt.defaults=e.extend({},e.prompt.defaults,t)},e.prompt.setStateDefaults=function(t){e.prompt.defaults.state=e.extend({},e.prompt.defaults.state,t)},e.prompt.position=function(t){var n=e.fx.off,r=e.prompt.getCurrentState(),i=e.prompt.options.states[r.data("jqi-name")],o=i?i.position:void 0,s=e(window),a=document.body.scrollHeight,u=e(window).height(),l=(e(document).height(),a>u?a:u),c=parseInt(s.scrollTop(),10)+((""+e.prompt.options.top).indexOf("%")>=0?u*(parseInt(e.prompt.options.top,10)/100):parseInt(e.prompt.options.top,10));if(void 0!==t&&t.data.animate===!1&&(e.fx.off=!0),e.prompt.jqib.css({position:"absolute",height:l,width:"100%",top:0,left:0,right:0,bottom:0}),e.prompt.jqif.css({position:"fixed",height:l,width:"100%",top:0,left:0,right:0,bottom:0}),o&&o.container){var p=e(o.container).offset();e.isPlainObject(p)&&void 0!==p.top&&(e.prompt.jqi.css({position:"absolute"}),e.prompt.jqi.animate({top:p.top+o.y,left:p.left+o.x,marginLeft:0,width:void 0!==o.width?o.width:null}),c=p.top+o.y-((""+e.prompt.options.top).indexOf("%")>=0?u*(parseInt(e.prompt.options.top,10)/100):parseInt(e.prompt.options.top,10)),e("html,body").animate({scrollTop:c},"slow","swing",function(){}))}else o&&o.width?(e.prompt.jqi.css({position:"absolute",left:"50%"}),e.prompt.jqi.animate({top:o.y||c,left:o.x||"50%",marginLeft:-1*(o.width/2),width:o.width})):e.prompt.jqi.css({position:"absolute",top:c,left:"50%",marginLeft:-1*(e.prompt.jqi.outerWidth(!1)/2)});void 0!==t&&t.data.animate===!1&&(e.fx.off=n)},e.prompt.style=function(){e.prompt.jqif.css({zIndex:e.prompt.options.zIndex,display:"none",opacity:e.prompt.options.opacity}),e.prompt.jqi.css({zIndex:e.prompt.options.zIndex+1,display:"none"}),e.prompt.jqib.css({zIndex:e.prompt.options.zIndex})},e.prompt.get=function(){return e("."+e.prompt.currentPrefix)},e.prompt.addState=function(t,n,r){var i,o,s,a="",u=null,l="",c="",p=e.prompt.options,f=e("."+e.prompt.currentPrefix+"states"),d=0;n=e.extend({},e.prompt.defaults.state,{name:t},n),null!==n.position.arrow&&(l='<div class="'+p.prefix+"arrow "+p.prefix+"arrow"+n.position.arrow+'"></div>'),n.title&&""!==n.title&&(c='<div class="lead '+p.prefix+"title "+p.classes.title+'">'+n.title+"</div>"),a+='<div id="'+p.prefix+"state_"+t+'" class="'+p.prefix+'state" data-jqi-name="'+t+'" style="display:none;">'+l+c+'<div class="'+p.prefix+"message "+p.classes.message+'">'+n.html+'</div><div class="'+p.prefix+"buttons "+p.classes.buttons+'"'+(e.isEmptyObject(n.buttons)?'style="display:none;"':"")+">";for(o in n.buttons)s=n.buttons[o],i=n.focus===d||isNaN(n.focus)&&n.defaultButton===d?e.prompt.currentPrefix+"defaultbutton "+p.classes.defaultButton:"","object"==typeof s?(a+='<button class="'+p.classes.button+" "+e.prompt.currentPrefix+"button "+i,void 0!==s.classes&&(a+=" "+(e.isArray(s.classes)?s.classes.join(" "):s.classes)+" "),a+='" name="'+p.prefix+"_"+t+"_button"+s.title.replace(/[^a-z0-9]+/gi,"")+'" id="'+p.prefix+"_"+t+"_button"+s.title.replace(/[^a-z0-9]+/gi,"")+'" value="'+s.value+'">'+s.title+"</button>"):a+='<button class="'+e.prompt.currentPrefix+"button "+p.classes.button+" "+i+'" name="'+p.prefix+"_"+t+"_button"+o.replace(/[^a-z0-9]+/gi,"")+'" id="'+p.prefix+"_"+t+"_button"+o.replace(/[^a-z0-9]+/gi,"")+'" value="'+s+'">'+o+"</button>",d++;return a+="</div></div>",u=e(a),u.on("impromptu:submit",n.submit),void 0!==r?f.find("#"+e.prompt.currentPrefix+"state_"+r).after(u):f.append(u),e.prompt.options.states[t]=n,u},e.prompt.removeState=function(t){var n=e.prompt.getState(t),r=function(){n.remove()};return 0===n.length?!1:("none"!==n.css("display")?n.next().length>0?e.prompt.nextState(r):e.prompt.prevState(r):n.slideUp("slow",r),!0)},e.prompt.getState=function(t){return e("#"+e.prompt.currentPrefix+"state_"+t)},e.prompt.getStateContent=function(t){return e.prompt.getState(t)},e.prompt.getCurrentState=function(){return e.prompt.getState(e.prompt.getCurrentStateName())},e.prompt.getCurrentStateName=function(){return e.prompt.currentStateName},e.prompt.goToState=function(t,n,r){var i=(e.prompt.get(),e.prompt.options),o=e.prompt.getState(t),s=i.states[o.data("jqi-name")],a=new e.Event("impromptu:statechanging");return"function"==typeof n&&(r=n,n=!1),e.prompt.jqib.trigger(a,[e.prompt.getCurrentStateName(),t]),!a.isDefaultPrevented()&&o.length>0&&(e.prompt.jqi.find("."+e.prompt.currentPrefix+"parentstate").removeClass(e.prompt.currentPrefix+"parentstate"),n?(e.prompt.jqi.find("."+e.prompt.currentPrefix+"substate").not(o).slideUp(i.promptspeed).removeClass("."+e.prompt.currentPrefix+"substate").find("."+e.prompt.currentPrefix+"arrow").hide(),e.prompt.jqi.find("."+e.prompt.currentPrefix+"state:visible").addClass(e.prompt.currentPrefix+"parentstate"),o.addClass(e.prompt.currentPrefix+"substate")):e.prompt.jqi.find("."+e.prompt.currentPrefix+"state").not(o).slideUp(i.promptspeed).find("."+e.prompt.currentPrefix+"arrow").hide(),e.prompt.currentStateName=s.name,o.slideDown(i.promptspeed,function(){var n=e(this);"string"==typeof s.focus?n.find(s.focus).eq(0).focus():n.find("."+e.prompt.currentPrefix+"defaultbutton").focus(),n.find("."+e.prompt.currentPrefix+"arrow").show(i.promptspeed),"function"==typeof r&&e.prompt.jqib.on("impromptu:statechanged",r),e.prompt.jqib.trigger("impromptu:statechanged",[t]),"function"==typeof r&&e.prompt.jqib.off("impromptu:statechanged",r)}),n||e.prompt.position()),o},e.prompt.nextState=function(t){var n=e("#"+e.prompt.currentPrefix+"state_"+e.prompt.getCurrentStateName()).next();return n.length>0&&e.prompt.goToState(n.attr("id").replace(e.prompt.currentPrefix+"state_",""),t),n},e.prompt.prevState=function(t){var n=e("#"+e.prompt.currentPrefix+"state_"+e.prompt.getCurrentStateName()).prev();return n.length>0&&e.prompt.goToState(n.attr("id").replace(e.prompt.currentPrefix+"state_",""),t),n},e.prompt.close=function(t,n,r,i){e.prompt.timeout&&(clearTimeout(e.prompt.timeout),e.prompt.timeout=!1),e.prompt.jqib&&e.prompt.jqib.fadeOut("fast",function(){e.prompt.jqib.trigger("impromptu:close",[n,r,i]),e.prompt.jqib.remove(),e(window).off("resize",e.prompt.position)})},e.fn.prompt=function(t){void 0===t&&(t={}),void 0===t.withDataAndEvents&&(t.withDataAndEvents=!1),e.prompt(e(this).clone(t.withDataAndEvents).html(),t)}}(jQuery);