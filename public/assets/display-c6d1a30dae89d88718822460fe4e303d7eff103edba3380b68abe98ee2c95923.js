function getClusterRels(t){try{{Object.keys(t).length}}catch(e){}}function getClusterRels(t){try{var e=Object.keys(t).length}catch(i){var e=0}return e>=50?6:e>=30?5:e>=20?4:e>=10?3:e>=5?2:e>=1?1:0}function getColorsRels(){return{0:"#bdbdbd",1:"#d73027",2:"#f46d43",3:"#fdae61",4:"#abd9e9",5:"#74add1",6:"#4575b4"}}function notInArray(t,e){for(var i=t.length;i--;){if(t[i][0]==e[0]&&t[i][1]==e[1])return!1;if(t[i][1]==e[0]&&t[i][0]==e[1])return!1}return!0}function createNodeKey(t,e){return{text:t.display_name,size:10,id:e,cluster:getClusterRels(t.rel_sum)}}function twoDegs(t,e,i){function n(t,e){var i=e[t];$.each(i.rel_sum,function(i,n){var r=n[0];s[r]=createNodeKey(e[r],r),notInArray(o,[t,n[0]])&&o.push([t,n[0]]),$.each(e[r].rel_sum,function(t,i){var r=i[0];r in e&&(s[r]=createNodeKey(e[r],r),notInArray(o,[n[0],i[0]])&&o.push([n[0],i[0]]))})}),s[t]={text:i.display_name,size:30,id:t,cluster:getClusterRels(i.rel_sum)}}var s={},o=[],r=[];n(t,i),0!=e&&""!=e&&(n(e,i),s[e]={text:i[e].display_name,size:30,id:e,cluster:getClusterRels(i[e].rel_sum)},s[t]={text:i[t].display_name,size:30,id:t,cluster:getClusterRels(i[t].rel_sum)}),$.each(s,function(t,e){r.push(e)}),o.reverse();var a=window.innerWidth,l=window.innerHeight,h={width:a,height:l,collisionAlpha:25,colors:getColorsRels()},u=new Insights($("#graph")[0],r,o,h).render();u.on("node:click",function(t){i[t.id];$.ajax({type:"GET",url:"/node_info",data:{node_id:t.id},datatype:"html",success:function(){},async:!0}),accordion("node")}),u.on("edge:click",function(t){parseInt(t.source.id),parseInt(t.target.id);$.ajax({type:"GET",url:"/network_info",data:{source_id:t.source.id,target_id:t.target.id},datatype:"html",success:function(){},async:!0}),accordion("edge")}),u.tooltip("<div class='btn' >{{text}}</div>"),$("#zoom button.icon").click(function(){"in"==this.name?(u.zoomIn(),u.center()):"out"==this.name&&(u.zoomOut(),u.center())})}function getConfidence(t){return t>=0&&19>=t?"Very Unlikely":t>=20&&39>=t?"Unlikely":t>=40&&59>=t?"Possible":t>=60&&79>=t?"Likely":"Certain"}function getParam(t){var e=location.search.substr(location.search.indexOf("?")+1),i="";e=e.split("&");for(var n=0;n<e.length;n++)temp=e[n].split("="),[temp[0]]==t&&(i=temp[1]);return i}function showAccordion(t,e){"0"==e&&($.ajax({type:"GET",url:"/node_info",data:{node_id:t},datatype:"html",success:function(){},async:!0}),accordion("node"))}function filterGraph(t){var e=getParam("id"),i=getParam("id2");(""==i||"0"==i)&&(i=0),""==e&&(e=francisID),twoDegs(e,i,t),showAccordion(e,i)}function initGraph(t){var e=default_sconfidence+" to "+default_econfidence,i=default_sdate+" - "+default_edate;if(getParam("id")>0)var n=t[parseInt(getParam("id"))].display_name;else var n=t[francisID].display_name;if(getParam("id2")>0)var s=" and "+t[parseInt(getParam("id2"))].display_name;else var s="";getParam("confidence").length>0&&(e=getParam("confidence").replace(",","% to ")),getParam("date").length>0&&(i=getParam("date").replace(","," to ")),$("#results").html("Two Degrees of "+n+s+" at "+e+"% from "+i+" (100 node display limit)")}function sidebarSearch(){$("#search-network-submit").click(function(){var t="no";Pace.restart();var e=$("#search-network-name-id").val();1==$("#show-table").val()&&(t="yes");var i=$("#search-network-slider-confidence-result-hidden").val().split(" - "),n=$("#search-network-slider-date-result-hidden").val().split(" - ");e&&i&&n&&(window.location.href="/?id="+e+"&confidence="+i+"&date="+n)}),$("#search-shared-network-submit").click(function(){var t="no";if(Pace.restart(),$("#search-shared-network-name1-id").val())var e=$("#search-shared-network-name1-id").val();if($("#search-shared-network-name2-id").val())var i=$("#search-shared-network-name2-id").val();1==$("#show-table").val()&&(t="yes");var n=$("#search-shared-network-slider-confidence-result-hidden").val().split(" - "),s=$("#search-shared-network-slider-date-result-hidden").val().split(" - ");e&&i&&s&&n&&(window.location.href="/?id="+e+"&id2="+i+"&confidence="+n+"&date="+s+"&table="+t)}),$("#search-group-submit").click(function(){Pace.restart();var t=$("#search-group-name-id").val();t&&(window.location.href="/?group="+t)}),$("#search-shared-group-submit").click(function(){Pace.restart();var t=$("#search-shared-group-name1-id").val(),e=$("#search-shared-group-name2-id").val();t&&e&&(window.location.href="/?group="+t+"&group2="+e)}),$("#nav-filter-submit").click(function(){var t=getParam("id"),e=getParam("id2");ID2Str=""!=e?"&id2="+e:"";var i=$("#nav-slider-confidence-result-hidden").val().split(" - "),n=$("#nav-slider-date-result-hidden").val().split(" - ");""!=t&&(window.location.href="/?id="+t+ID2Str+"&confidence="+i+"&date="+n),""==t&&(window.location.href="/?id="+francisID+ID2Str+"&confidence="+i+"&date="+n)}),$("aside button.icon").click(function(){addNodes=[],addEdges=[];var t=$("#node-name").html()+" ("+$("#node-bdate").html()+")";"icon-tag"==this.id?$("#entry_1177061505").val(t):"icon-link"==this.id&&$("#entry_768090773").val(t)})}function init(){var t=window.gon.people,e=(window.gon.group_data,window.gon.group),i=window.gon.group2,n=window.gon.group_members;sidebarSearch(t),void 0!=t&&("nodelimit"==t[0]&&($("#group-table").hide(),$("#kickback").show(),$("#kickbackyes").attr("href","/people_relationships?id="+t[1]),$("#kickbackno").click(function(){$("#kickback").hide(),$("#search-network-name").val(t[2][0].display_name),$("#search-network-name").click(),$("#search-network-name-id").val(t[1]),$("#search-button").click()})),"nodelimit_network"==t[0]&&($("#group-table").hide(),$("#kickback").show(),$("#kickbackyes").attr("href","/relationships/"+t[1]),$("#kickbackno").click(function(){$("#kickback").hide(),$("#search-shared-network-name1").val(t[4][0].display_name),$("#search-shared-network-name1").click(),$("#search-shared-network-name1-id").val(t[2]),$("#search-shared-network-name2").val(t[5][0].display_name),$("#search-shared-network-name2").click(),$("#search-shared-network-name2-id").val(t[3]),$("#search-button").click(),$("#search-shared-network").click()}))),0==getParam("group").length?(filterGraph(t),initGraph(t),$("#group-table").hide()):(accordion("group"),$("#filterBar").hide(),$("#group-name").text(e.name),$("#group-description").text(e.description),$("#group-discussion").attr("href","groups/"+e.id),$("#group-icon-annotate").attr("href","/user_group_contribs/new?group_id="+e.id),$("#group-icon-tag").attr("href","/group_assignments/new?group_id="+e.id),$(".group2").hide(),"undefined"!=typeof i&&($("#group-name2").text(i.name),$("#group-description2").text(i.description),$("#group-discussion2").attr("href","groups/"+i.id),$(".group2").show(),$("#group-icon-annotate2").attr("href","/user_group_contribs/new?group_id="+i.id),$("#group-icon-tag2").attr("href","/group_assignments/new?group_id="+i.id)),$.each(n,function(t){$("#group-table").append("<div class='group-row'><div class='col-md'>"+n[t].display_name+"</div><div class='col-md'>"+n[t].ext_birth_year+"</div><div class='col-md'>"+n[t].ext_death_year+"</div><div class='col-md'><a href='/people/"+n[t].id+"'>"+ +n[t].id+"</a></div></div>")}))}var francisID=10000473,default_sconfidence=60,default_econfidence=100,default_sdate=1500,default_edate=1700;$("#zoom button.icon").click(function(){"in"==this.name?graph.zoomIn():graph.zoomOut()}),$(document).ready(function(){init()});