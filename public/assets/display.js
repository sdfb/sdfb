function showNodeInfo(){accordion("node")}function getClusterRels(e){var t=e.size;return t>100?10:Math.floor(t/2)/10}function getColorsRels(){return{0:"#f56046",1:"#ffbb12",2:"#73cab5",3:"#1d7578",4:"#b6dcf2",5:"#ff00ff",6:"#9954e2"}}function notInArray(e,t){for(var a=e.length;a--;){if(e[a][0]==t[0]&&e[a][1]==t[1])return!1;if(e[a][1]==t[0]&&e[a][0]==t[1])return!1}return!0}function createNodeKey(e,t){var a={text:e.display_name,size:10,id:t,cluster:1};return a}function twoDegs(e,t,a,n,i,r,o){function l(e,t){var a=t[e];$.each(a.rel_sum,function(a,n){var i=n[0];s[i]=createNodeKey(t[i],i),notInArray(d,[e,n[0]])&&d.push([e,n[0]]),$.each(t[i].rel_sum,function(e,a){var i=a[0];i in t&&(s[i]=createNodeKey(t[i],i),notInArray(d,[n[0],a[0]])&&d.push([n[0],a[0]]))})}),s[e]={text:a.display_name,size:30,id:e,cluster:2}}var s={},d=[],c=[];l(e,a,n,i,r,o),0!=t&&""!=t&&l(t,a,n,i,r,o),$.each(s,function(e,t){c.push(t)}),d.reverse();var u=window.innerWidth,m=window.innerHeight-$("#head").height()-$("#filterBar").height(),h={width:u,height:m,collisionAlpha:25,colors:getColorsRels()},p=new Insights($("#graph")[0],c,d,h).render();p.on("node:click",function(e){var t=a[e.id];$.ajax({type:"GET",url:"/node_info",data:{node_id:e.id},datatype:"html",success:function(){},async:!0}),showNodeInfo(t)}),p.on("edge:click",function(e){var t=parseInt(e.source.id),a=parseInt(e.target.id);getAnnotation(a>t?t:a,t>a?t:a,data)}),p.tooltip("<div class='btn' >{{text}}</div>"),$("#zoom button.icon").click(function(){"in"==this.name?(p.zoomIn(),p.center()):"out"==this.name&&(p.zoomOut(),p.center())})}function getConfidence(e){return e>=0&&19>=e?"very unlikely":e>=20&&39>=e?"unlikely":e>=40&&59>=e?"possible":e>=60&&79>=e?"likely":"certain"}function getAnnotation(e,t,a){var n=a[e].rels,i="",r="";return $.each(n,function(e,a){a[0]==t&&(i=getConfidence(a[1])+" @ "+a[1]+"%",r=a[3])}),accordion("edge"),$("#edge-nodes").html(a[e].display_name+" & "+a[t].display_name),$("#edge-confidence").html(i),$("#edge-discussion").attr("href","/relationships/"+r),$("#edge-icon-annotate").attr("href","/user_rel_contribs/new?relationship_id="+r),!0}function getParam(e){var t=location.search.substr(location.search.indexOf("?")+1),a="";t=t.split("&");for(var n=0;n<t.length;n++)temp=t[n].split("="),[temp[0]]==e&&(a=temp[1]);return a}function filterGraph(e){var t=getParam("id"),a=getParam("id2"),n=getParam("confidence").split(",")[0],i=getParam("confidence").split(",")[1],r=getParam("date"),o=r.substring(0,3),l=r.substring(5,8);(""==a||"0"==a)&&(a=0),""==r&&(o=default_sdate,l=default_edate),""==t&&(t=francisID),""==n&&(n=default_sconfidence),""==i&&(i=default_econfidence),twoDegs(t,a,e,n,i,o,l)}function initGraph(e){var t=default_sconfidence+" to "+default_econfidence,a=default_sdate+" - "+default_edate;if(getParam("id")>0)var n=e[parseInt(getParam("id"))].display_name;else var n=e[francisID].display_name;if(getParam("id2")>0)var i=" and "+e[parseInt(getParam("id2"))].display_name;else var i="";getParam("confidence").length>0&&(t=getParam("confidence").replace(",","% to ")),getParam("date").length>0&&(a=getParam("date").replace(","," to ")),$("#results").html("Two degrees of "+n+i+" at "+t+"% from "+a),$("#search-network-submit").click(function(){var e="no";Pace.restart();var t=$("#search-network-name-id").val();1==$("#show-table").val()&&(e="yes");var a=$("#search-network-slider-confidence-result-hidden").val().split(" - "),n=$("#search-network-slider-date-result-hidden").val().split(" - ");window.location.href="/?id="+t+"&confidence="+a+"&date="+n+"&table="+e}),$("#search-shared-network-submit").click(function(){var e="no";if(Pace.restart(),$("#search-shared-network-name1-id").val())var t=$("#search-shared-network-name1-id").val();if($("#search-shared-network-name2-id").val())var a=$("#search-shared-network-name2-id").val();1==$("#show-table").val()&&(e="yes");var n=$("#search-shared-network-slider-confidence-result-hidden").val().split(" - "),i=$("#search-shared-network-slider-date-result-hidden").val().split(" - ");window.location.href="/?id="+t+"&id2="+a+"&confidence="+n+"&date="+i+"&table="+e}),$("#nav-filter-submit").click(function(){var e=getParam("id"),t=getParam("id2");ID2Str=""!=t?"&id2="+t:"";var a=$("#nav-slider-confidence-result-hidden").val().split(" - "),n=$("#nav-slider-date-result").val().split(" - ");""!=e&&(window.location.href="/?id="+e+ID2Str+"&confidence="+a+"&date="+n),""==e&&(window.location.href="/?id="+francisID+ID2Str+"&confidence="+a+"&date="+n)}),$("aside button.icon").click(function(){addNodes=[],addEdges=[];var e=$("#node-name").html()+" ("+$("#node-bdate").html()+")";"icon-tag"==this.id?$("#entry_1177061505").val(e):"icon-link"==this.id&&$("#entry_768090773").val(e)})}function init(){var e={nodes:[],edges:[],groups_names:[],groups_desc:[],groups_people:[]},t=window.gon.people,a=window.gon.group_data;$.each(a,function(t,a){e.groups_names.push(a.name),e.groups_desc.push(a.description),e.groups_people.push(a.person_list)}),filterGraph(t),initGraph(t)}var francisID=10000473,default_sconfidence=60,default_econfidence=100,default_sdate=1400,default_edate=1800;$("#zoom button.icon").click(function(){"in"==this.name?graph.zoomIn():graph.zoomOut()}),$(document).ready(function(){init()});