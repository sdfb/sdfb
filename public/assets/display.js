function getClusterRels(e){var t=e.size;return t>100?10:Math.floor(t/2)/10}function getColorsRels(){return{0:"#f56046",1:"#ffbb12",2:"#73cab5",3:"#1d7578",4:"#b6dcf2",5:"#ff00ff",6:"#9954e2"}}function notInArray(e,t){for(var a=e.length;a--;){if(e[a][0]==t[0]&&e[a][1]==t[1])return!1;if(e[a][1]==t[0]&&e[a][0]==t[1])return!1}return!0}function showNodeInfo(e){accordion("node"),$("#node-name").text(e.display_name),$("#node-bdate").text(e.birth_year_type+" "+e.birth_year),$("#node-ddate").text(e.death_year_type+" "+e.death_year),$("#node-significance").text(e.occupation),$("#node-group").text(e.groups.join(","));var t=new Date;$("#node-cite").text(e.first+" "+e.last+" Network Visualization. \n Six Degrees of Francis Bacon: Reassembling the Early Modern Social Network. Gen. eds. Daniel Shore and Christopher Warren. "+t.getMonth()+"/"+t.getDate()+"/"+t.getFullYear()+" <http://sixdegreesoffrancisbacon.com/>"),e.odnb_id>0?$("#node-DNBlink").attr("href","http://www.oxforddnb.com/view/article/"+e.odnb_id):$("#node-DNBlink").attr("href","http://www.oxforddnb.com/search/quick/?quicksearch=quicksearch&docPos=1&searchTarget=people&simpleName="+e.first+"+"+e.last),$("#node-GoogleLink").attr("href","http://www.google.com/search?q="+e.first+"+"+e.last),$("#node-discussion").attr("href","/people/"+e.id),$("#node-icon-chain").attr("href","/relationships/new?person1_id="+e.id),$("#node-icon-annotate").attr("href","/user_person_contribs/new?person_id="+e.id)}function createNodeKey(e){var t={text:e.first+" "+e.last,size:4,id:e.id,cluster:getClusterRels(e)};return t}function twoDegs(e,t,a,i,n,r,o){function s(e,t,a,i,n,r){var o=t.nodes[e];$.each(o.rels,function(e,s){if(0==s[2]||s[1]<a||s[1]>i||r<o.birth_year||n>o.death_year);else{var c=t.nodes[s[0]];l[c.id]=createNodeKey(c),notInArray(d,[o.id,c.id])&&d.push([o.id,c.id])}}),l[o.id]={text:o.display_name,size:20,id:o.id,cluster:getClusterRels(o)}}var l={},d=[],c=[];s(e,a,i,n,r,o),0!=t&&""!=t&&s(t,a,i,n,r,o),$.each(l,function(e,t){c.push(t)}),d.reverse();var u=window.innerWidth,h=window.innerHeight,m={width:u,height:h,collisionAlpha:10,colors:getColorsRels()},p=new Insights($("#graph")[0],c,d,m).render();p.focus(e),p.on("node:click",function(e){var t=a.nodes[e.id];showNodeInfo(t)}),p.on("edge:click",function(e){var t=parseInt(e.source.id),i=parseInt(e.target.id);getAnnotation(i>t?t:i,t>i?t:i,a)}),p.tooltip("<div class='btn' >{{text}}</div>"),$("#zoom button.icon").click(function(){"in"==this.name?(p.zoomIn(),p.center()):"out"==this.name&&(p.zoomOut(),p.center())})}function getConfidence(e){return e>=0&&19>=e?"very unlikely":e>=20&&39>=e?"unlikely":e>=40&&59>=e?"possible":e>=60&&79>=e?"likely":"certain"}function getAnnotation(e,t,a){var i=a.nodes[e].rels,n="",r="";return $.each(i,function(e,a){a[0]==t&&(n=getConfidence(a[1])+" @ "+a[1]+"%",r=a[3])}),accordion("edge"),$("#edge-nodes").html(a.nodes[e].first+" "+a.nodes[e].last+" & "+a.nodes[t].first+" "+a.nodes[t].last),$("#edge-confidence").html(n),$("#edge-discussion").attr("href","/relationships/"+r),$("#edge-icon-annotate").attr("href","/user_rel_contribs/new?relationship_id="+r),!0}function getParam(e){var t=location.search.substr(location.search.indexOf("?")+1),a="";t=t.split("&");for(var i=0;i<t.length;i++)temp=t[i].split("="),[temp[0]]==e&&(a=temp[1]);return a}function filterGraph(e){var t=getParam("id"),a=getParam("id2"),i=getParam("confidence").split(",")[0],n=getParam("confidence").split(",")[1],r=getParam("date"),o=r.substring(0,3),s=r.substring(5,8);(""==a||"0"==a)&&(a=0),""==r&&(o=default_sdate,s=default_edate),""==t&&(t=francisID),""==i&&(i=default_sconfidence),""==n&&(n=default_econfidence),twoDegs(t,a,e,i,n,o,s)}function initGraph(e){var t=default_sconfidence+" to "+default_econfidence,a=default_sdate+" - "+default_edate;if(getParam("id")>0)var i=e.nodes[parseInt(getParam("id"))].label;else var i=e.nodes[francisID].label;getParam("confidence").length>0&&(t=getParam("confidence").replace(",","% to ")),getParam("date").length>0&&(a=getParam("date").replace(","," to ")),$("#results").html("Two degrees of "+i+" at "+t+"% from "+a),$("#search-network-submit").click(function(){var e="no";Pace.restart();var t=$("#search-network-name-id").val();1==$("#show-table").val()&&(e="yes");var a=$("#search-network-slider-confidence-result-hidden").val().split(" - "),i=$("#search-network-slider-date-result-hidden").val().split(" - ");window.location.href="/?id="+t+"&confidence="+a+"&date="+i+"&table="+e}),$("#search-shared-network-submit").click(function(){var e="no";if(Pace.restart(),$("#search-shared-network-name1-id").val())var t=$("#search-shared-network-name1-id").val();if($("#search-shared-network-name2-id").val())var a=$("#search-shared-network-name2-id").val();1==$("#show-table").val()&&(e="yes");var i=$("#search-shared-network-slider-confidence-result-hidden").val().split(" - "),n=$("#search-shared-network-slider-date-result-hidden").val().split(" - ");window.location.href="/?id="+t+"&id2="+a+"&confidence="+i+"&date="+n+"&table="+e}),$("#nav-filter-submit").click(function(){var e=getParam("id"),t=$("#nav-slider-confidence-result-hidden").val().split(" - "),a=$("#nav-slider-date-result").val().split(" - ");""!=e&&(window.location.href="/?id="+e+"&confidence="+t+"&date="+a),""==e&&(window.location.href="/?id="+francisID+"&confidence="+t+"&date="+a)}),$("aside button.icon").click(function(){addNodes=[],addEdges=[];var e=$("#node-name").html()+" ("+$("#node-bdate").html()+")";"icon-tag"==this.id?$("#entry_1177061505").val(e):"icon-link"==this.id&&$("#entry_768090773").val(e)})}function init(){var e={nodes:[],edges:[],groups_names:[],groups_desc:[],groups_people:[],nodeKeys:[]},t=window.gon.people,a=window.gon.group_data;if("object"===jQuery.type(t)){var i={};i.id=t.id,i.first=t.first_name,i.last=t.last_name,i.label=i.first+" "+i.last,i.name_date=i.first+" "+i.last+" ("+i.birth+")",i.display_name=t.display_name,i.birth_year=t.ext_birth_year,i.birth_year_type=t.birth_year_type,i.death_year=t.ext_death_year,i.death_year_type=t.death_year_type,i.occupation=t.historical_significance,i.rels=t.rel_sum,i.size=i.rels.length,i.odnb_id=t.odnb_id,i.groups=t.group_list,e.nodes[i.id]=i}else $.each(t,function(t,a){var i={};i.id=a.id,i.first=a.first_name,i.last=a.last_name,i.label=i.first+" "+i.last,i.name_date=i.first+" "+i.last+" ("+i.birth+")",i.display_name=a.display_name,i.birth_year=a.ext_birth_year,i.birth_year_type=a.birth_year_type,i.death_year=a.ext_death_year,i.death_year_type=a.death_year_type,i.occupation=a.historical_significance,i.rels=a.rel_sum,i.size=i.rels.length,i.odnb_id=a.odnb_id,i.groups=a.group_list,e.nodes[i.id]=i});$.each(a,function(t,a){e.groups_names.push(a.name),e.groups_desc.push(a.description),e.groups_people.push(a.person_list)}),filterGraph(e),initGraph(e)}var francisID=10000473,default_sconfidence=40,default_econfidence=100,default_sdate=1400,default_edate=1800;$("#zoom button.icon").click(function(){"in"==this.name?graph.zoomIn():graph.zoomOut()}),$(document).ready(function(){init()});