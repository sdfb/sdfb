function node(){this.id=null,this.first=null,this.last=null,this.birth=null,this.death=null,this.label=null,this.name=null,this.occupation=null,this.edges=[]}function group(){this.id=null,this.name=null,this.nodes=null}function init(){var t={nodes:{},groups:{},nodes_names:{},groups_names:{}},e=gon.people;for(p in e){var n=new node;n.id=p.original_id,n.first=p.first_name,n.last=p.last_name,n.birth=p.birth_year,n.death=p.death_year,n.occupation=p.historical_significance,n.label=n.first+" "+n.last,t.nodes[n.id]=n;for(rel in p.rel_sum)rel[0]in nodes||(n.edge+=rel)}this.initGraph(t)}function makeGraph(t){{var e=t[0],n=t[1],i={width:$("#graph").width(),height:$("#graph").height(),colors:getColors()};new Insights($("#graph")[0],e,n,i).render()}}function initGraph(t){$("#findonenode").click(function(){$("#one").val()&&(Pace.restart(),showOneNode(t.nodes_names[$("#one").val()],parseInt($("#confidence1")[0].value),t),$("#twogroupsmenu").css("display","none")),resetInputs()}),$("#findtwonode").click(function(){$("#two").val()&&$("#three").val()&&(Pace.restart(),showTwoNodes(t.nodes_names[$("#two").val()],t.nodes_names[$("#three").val()],parseInt($("#confidence2")[0].value),t),$("#twogroupsmenu").css("display","none")),resetInputs()}),$("#findonegroup").click(function(){$("#four").val()&&(Pace.restart(),showOneGroup($("#four").val(),t),$("#twogroupsmenu").css("display","none")),resetInputs()}),$("#findtwogroup").click(function(){$("#five").val()&&$("#six").val()&&(Pace.restart(),$("#group1").html($("#five").val()),$("#group3").html($("#six").val()),findInterGroup($("#group1").html(),$("#group3").html(),t)),resetInputs()}),$("#group1").click(function(){showOneGroup($("#group1").html(),t)}),$("#group3").click(function(){showOneGroup($("#group3").html(),t)}),$("#group2").click(function(){findInterGroup($("#group1").html(),$("#group3").html(),t)}),$("#submitnode").click(function(){Pace.restart();var t=$("#entry_1804360896").val()+" "+$("#entry_754797571").val(),e=$("#entry_524366257").val();$("section").css("display","none"),$("#addedgeform").css("display","block"),$("#entry_768090773").val(t+" ("+e+")"),$("#graph").html(""),$("#results").html(""),addNodes=[],addEdges=[],addNodes.push({id:0,text:t,size:14,cluster:getCluster(e)});var n={width:$("#graph").width(),height:$("#graph").height(),colors:getColors()},i=(new Insights($("#graph")[0],addNodes,[],n).render(),"https://docs.google.com/spreadsheets/d/1-faviCW5k2v7DVOHpSQT-grRqNU1lBVkUjJEVfOvSs8/edit#gid=688870062");$.prompt("Thank you for your person contribution! You can review your submission by going to <a href='"+i+"' target='_blank'>link</a>")}),$("#submitedge").click(function(){Pace.restart();var e=t.nodes_names[$("#entry_1321382891").val()],n=t.nodes[e];if(!n.id)return void window.alert("Incorrect information. Please try again.");if(0!=addNodes.length){$("#graph").html(""),$("#results").html(""),addNodes.push({id:n.id,text:n.label,size:4,cluster:getCluster(n.birth)}),addEdges.push([0,n.id]);var i={width:$("#graph").width(),height:$("#graph").height(),colors:getColors()},o=(new Insights($("#graph")[0],addNodes,addEdges,i).render(),"https://docs.google.com/spreadsheets/d/1cu7hpYQMWTO8C7F8V34BEbdB2NrUe1xsslWKoai3BWE/edit#gid=51712082");$.prompt("Thank you for your annotated relationship contribution! You can review your submission by going to <a href='"+o+"' target='_blank'>link</a>")}}),$("#submitgroup").click(function(){var t="https://docs.google.com/spreadsheet/ccc?key=0AhtG6Yl2-hiRdFFQS2hybWRXRVNkNVJXR2FENnhMM0E&usp=drive_web#gid=0";$.prompt("Thank you for your group contribution! You can review your submission by going to <a href='"+t+"' target='_blank'>link</a>")}),$("aside button.icon").click(function(){addNodes=[],addEdges=[],resetInputs();var t=$("#node-name").html()+" ("+$("#node-bdate").html()+")";"icon-tag"==this.id?$("#entry_1177061505").val(t):"icon-link"==this.id&&$("#entry_768090773").val(t)}),showFrancis(t)}function showFrancis(t){$("#graph").is(":visible")?showOneNode(968,3,t):setTimeout(function(){showFrancis(t)},1e3)}function getCluster(t){if(parseInt(t)<1550)return 0;if(parseInt(t)>1700)return 1;var e=Math.round((parseInt(t)-1550)/5);return 2+e}function getColors(){return{0:"#A6D9CA",1:"#F0623E",2:"#B99CCA",3:"#B8DCF4",4:"#F9F39C",5:"#339998",6:"#6566AD",7:"#F89939",8:"#558FCB",9:"#04A287",10:"#B53C84",11:"#F2805C",12:"#79BD90",13:"#654B9E",14:"#DD88B8",15:"#3D58A6",16:"#EF4C3A",17:"#99CC7D",18:"#4D6AB2",19:"#A1D7D0",20:"#FABC3E",21:"#EE6096",22:"#DADC44",23:"#B177B3",24:"#A573B1",25:"#78CDD6",26:"#60BD6D",27:"#3EA7C0",28:"#F59485",29:"#3F6FB6",30:"#F8EC49",31:"#1C57A7"}}function showOneNode(t,e,i){var o=i.nodes[t],r={},s=[],a=[],l=e;do o.edges[l].forEach(function(t){var e=i.nodes[t];e&&(r[e.id]={id:e.id,text:e.label,cluster:getCluster(e.birth),size:4},notInArray(a,[o.id,e.id])&&a.push([o.id,e.id]),e.edges[l].forEach(function(t){var n=i.nodes[t];n&&(r[n.id]={id:n.id,text:n.label,cluster:getCluster(n.birth),size:4},notInArray(a,[e.id,n.id])&&a.push([e.id,n.id]),n.edges[l].forEach(function(t){var e=i.nodes[t];e&&e.id in r&&notInArray(a,[n.id,e.id])&&a.push([n.id,e.id])}))}))}),l++;while(5>l);r[o.id]={id:o.id,text:o.label,cluster:getCluster(o.birth),size:14};for(n in r)s.push(r[n]);$("#graph").html(""),$("#results").html("Two degrees of <b>"+o.name+"</b> "+getConfidence(e));var u={width:$("#graph").width(),height:$("#graph").height(),colors:getColors()},c=new Insights($("#graph")[0],s,a,u).render();c.on("node:click",function(t){var e=i.nodes[t.id];showNodeInfo(e,findGroups(e,i))}),c.on("edge:click",function(t){Pace.restart();var e=parseInt(t.source.id),n=parseInt(t.target.id);getAnnotation(n>e?e:n,e>n?e:n,i)}),showNodeInfo(o,findGroups(o,i)),$("#zoom button.icon").click(function(){"in"==this.name?c.zoomIn():"out"==this.name&&c.zoomOut()})}function notInArray(t,e){for(var n=t.length;n--;){if(t[n][0]==e[0]&&t[n][1]==e[1])return!1;if(t[n][1]==e[0]&&t[n][0]==e[1])return!1}return!0}function findGroups(t,e){var n=[];for(var i in e.groups)e.groups[i].nodes.indexOf(t.id)>-1&&n.push(e.groups[i].name);var o=n.join(", ");return o}function showNodeInfo(t,e){accordion("node"),$("#node-name").text(t.first+" "+t.last),$("#node-bdate").text(t.birth),$("#node-ddate").text(t.death),$("#node-significance").text(t.occupation),$("#node-group").text(e);var n=new Date;$("#node-cite").text(t.first+" "+t.last+" Network Visualization. \n Six Degrees of Francis Bacon: Reassembling the Early Modern Social Network. Gen. eds. Daniel Shore and Christopher Warren. "+n.getMonth()+"/"+n.getDate()+"/"+n.getFullYear()+" <http://sixdegreesoffrancisbacon.com/>"),$("#node-DNBlink").attr("href","http://www.oxforddnb.com/search/quick/?quicksearch=quicksearch&docPos=1&searchTarget=people&simpleName="+t.first+"-"+t.last+"&imageField.x=0&imageField.y=0&imageField=Go"),$("#node-GoogleLink").attr("href","http://www.google.com/search?q="+t.first+"+"+t.last)}function showTwoNodes(t,e,i,o){if(t!==e){var r={},s=[],a=[],l=o.nodes[t],u=o.nodes[e],c=[];l.edges.forEach(function(t){return t.indexOf(u.id)>-1?(a.push([l.id,u.id]),void c.push({network:l.label+" \u2192 "+u.label})):void 0});var d=i;do l.edges[d].forEach(function(t){if(u.edges[d].indexOf(t)>-1){var e=o.nodes[t];e&&(r[e.id]={id:e.id,text:e.label,cluster:getCluster(e.birth),size:4},a.push([l.id,e.id]),a.push([u.id,e.id]),c.push({network:l.label+" \u2192 "+e.label+" \u2192 "+u.label}))}}),l.edges[d].forEach(function(t){var e=o.nodes[t];e&&e.edges[d].forEach(function(t){if(u.edges[d].indexOf(t)>-1){var n=o.nodes[t];n&&e.id!=u.id&&n.id!=l.id&&(r[e.id]={id:e.id,text:e.label,cluster:getCluster(e.birth),size:4},r[n.id]={id:n.id,text:n.label,cluster:getCluster(n.birth),size:4},notInArray(a,[l.id,e.id])&&a.push([l.id,e.id]),notInArray(a,[u.id,n.id])&&a.push([u.id,n.id]),notInArray(a,[e.id,n.id])&&a.push([e.id,n.id]),c.push({network:l.label+" \u2192 "+e.label+" \u2192 "+n.label+" \u2192 "+u.label}))}})}),d++;while(5>d);r[l.id]={id:l.id,text:l.label,cluster:getCluster(l.birth),size:14},r[u.id]={id:u.id,text:u.label,cluster:getCluster(u.birth),size:14};for(n in r)s.push(r[n]);$("#graph").html(""),$("#results").html("Common network between <b>"+l.label+"</b> and <b>"+u.label+"</b> "+getConfidence(i));var h={width:$("#graph").width(),height:$("#graph").height(),colors:getColors()},p=new Insights($("#graph")[0],s,a,h).render();p.on("node:click",function(t){var e=o.nodes[t.id];showNodeInfo(e,findGroups(e,o))}),$("#zoom button.icon").click(function(){"in"==this.name?p.zoomIn():p.zoomOut()}),$("#check-shared").is(":checked")&&(writeNetworkTable(c,"Common network between <b>"+l.label+"</b> and <b>"+u.label+"</b>"),$("#zoom").css("display","none"))}}function showOneGroup(t,e){var n=e.groups_names[t],i=[];n.nodes.forEach(function(t){i.push(e.nodes[t])}),0!=i.length&&i[0]||(i=[]),writeGroupTable(i,"People who belong to the "+t+" group"),$("#results").html("People who belong to the <b>"+t+"</b> group")}function findInterGroup(t,e,n){var i=n.groups_names[t],o=n.groups_names[e],r=[];i.nodes.forEach(function(t){o.nodes.indexOf(t)>=0&&r.push(n.nodes[t])}),0!=r.length&&r[0]||(r=[]),writeGroupTable(r,"Intersection between "+t+" and "+e),$("#results").html("Intersection between <b>"+t+"</b> and <b>"+e+"</b>")}function writeGroupTable(t,e){$("#graph").html('<table cellpadding="0" cellspacing="0" border="0" class="display table table-bordered table-striped" id="data-table-container"></table>'),$("#data-table-container").dataTable({sPaginationType:"bootstrap",iDisplayLength:100,aaData:t,aoColumns:[{mDataProp:"first",sTitle:"First Name"},{mDataProp:"last",sTitle:"Last Name"},{mDataProp:"birth",sTitle:"Birth Date"},{mDataProp:"death",sTitle:"Death Date"},{mDataProp:"occupation",sTitle:"Historical Significance"}],oLanguage:{sLengthMenu:"_MENU_ records per page"}}),downloadData(t,e)}function writeNetworkTable(t){$("#graph").html('<table cellpadding="0" cellspacing="0" border="0" class="display table table-bordered table-striped" id="data-table-container"></table>'),$("#data-table-container").dataTable({sPaginationType:"bootstrap",iDisplayLength:100,aaData:t,aoColumns:[{mDataProp:"network",sTitle:"Network"}],oLanguage:{sLengthMenu:"_MENU_ records per page"}})}function getAnnotation(t,e,n){var i=findConfidence(t,e,n);console.log(t+" "+e+" "+i),Tabletop.init({key:keys.annot,query:"source= "+t+" and target= "+e,wanted:[i],simpleSheet:!0,callback:function(o){o.forEach(function(o){return accordion("edge"),$("#edge-nodes").html(n.nodes[t].first+" "+n.nodes[t].last+" & "+n.nodes[e].first+" "+n.nodes[e].last),$("#edge-confidence").html(i),$("#edge-annotation").html(o.annotation),$("#edge-contributor").html(o.contributor),!0})}}),$("#icon-annotate").click(function(){resetInputs(),$("#entry_768090773").val(n.nodes[t].name),$("#entry_1321382891").val(n.nodes[e].name)})}function populateLists(t){$("#one").typeahead({local:Object.keys(t.nodes_names).sort()}),$("#two").typeahead({local:Object.keys(t.nodes_names).sort()}),$("#three").typeahead({local:Object.keys(t.nodes_names).sort()}),$("#entry_768090773").typeahead({local:Object.keys(t.nodes_names).sort()}),$("#entry_1321382891").typeahead({local:Object.keys(t.nodes_names).sort()}),$("#entry_1177061505").typeahead({local:Object.keys(t.nodes_names).sort()}),$("#four").typeahead({local:Object.keys(t.groups_names).sort()}),$("#five").typeahead({local:Object.keys(t.groups_names).sort()}),$("#six").typeahead({local:Object.keys(t.groups_names).sort()}),$("#entry_110233074").typeahead({local:Object.keys(t.groups_names).sort()})}function resetInputs(){$("#one").val(""),$("#one").typeahead("setQuery",""),$("#two").val(""),$("#two").typeahead("setQuery",""),$("#three").val(""),$("#three").typeahead("setQuery",""),$("#four").val(""),$("#four").typeahead("setQuery",""),$("#five").val(""),$("#five").typeahead("setQuery",""),$("#six").val(""),$("#six").typeahead("setQuery",""),document.getElementById("googleaddnode").reset(),document.getElementById("googleaddedge").reset(),document.getElementById("googleaddgroup").reset()}this.init();